<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>ENMeval 2.0.5 Vignette • ENMeval</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="ENMeval 2.0.5 Vignette">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ENMeval</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.0.5.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/ENMeval-2.0-vignette.html">ENMeval 2.0.5 Vignette</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>ENMeval 2.0.5 Vignette</h1>
                        <h4 data-toc-skip class="author">Jamie M. Kass,
Robert Muscarella, Gonzalo E. Pinilla-Buitrago, and Peter J.
Galante</h4>
            
            <h4 data-toc-skip class="date">2025-06-23</h4>
      

      <div class="d-none name"><code>ENMeval-2.0-vignette.Rmd</code></div>
    </div>

    
    
<ul>
<li><a href="#intro">Introduction</a></li>
<li><a href="#data">Data Acquisition &amp; Pre-processing</a></li>
<li><a href="#partition">Partitioning Occurrences for
Evaluation</a></li>
<li><a href="#eval">Running ENMeval</a></li>
<li><a href="#select">Model Selection</a></li>
<li><a href="#plot">Plotting results</a></li>
<li><a href="#null">Null Models</a></li>
<li><a href="#metadata">Metadata</a></li>
<li><a href="#resources">References and Resources</a></li>
</ul>
<div class="section level2">
<h2 id="intro">Introduction<a class="anchor" aria-label="anchor" href="#intro"></a>
</h2>
<ul>
<li>To align with the new <code>ENMeval</code> 2.0.5, this version
updates the vignette by replacing <code>raster</code> functions with
those from <code>terra</code>, and <code>dismo</code> functions with
those from <code>predicts</code>. These updates were made by G. E.
Pinilla-Buitrago.</li>
</ul>
<p><a href="https://cran.r-project.org/package=ENMeval" class="external-link"><code>ENMeval</code></a>
is an R package that performs automated tuning and evaluations of
ecological niche models (ENMs, a.k.a. species distribution models or
SDMs), which can estimate species’ ranges and niche characteristics
using data on species occurrences and environmental variables (Franklin
2010, Peterson et al. 2011, Guisan et al. 2017).</p>
<p>Some of the most frequently used ENMs are machine learning algorithms
with settings that can be “tuned” to determine optimal levels of model
complexity (Hastie et al. 2009, Radosavljevic &amp; Anderson 2014,
Hallgren et al. 2019). In implementation, this means building models of
varying settings, then evaluating them and comparing their performance
to select the optimal settings. Such tuning exercises can result in
models that balance goodness-of-fit (i.e., avoiding overfitting) and
predictive ability. Model evaluation is often done with
cross-validation, which consists of partitioning the data into groups,
building a model with all the groups but one, evaluating this model on
the left-out group, then repeating the process until all groups have
been left out once (Hastie et al. 2009, Roberts et al. 2017).</p>
<p><code>ENMeval</code> has one primary function,
<code>ENMevaluate</code>, which runs the tuning analysis and
evaluations, returning an <code>ENMevaluation</code> object that
contains the results. These results include a table of evaluation
statistics, fitted model objects, and prediction rasters for each
combination of model settings. The older versions of
<code>ENMeval</code> (0.3.0 and earlier; Muscarella et al. 2014)
implemented only the ENM presence-background algorithm Maxent through
the Java software <a href="http://biodiversityinformatics.amnh.org/open_source/maxent/" class="external-link">maxent.jar</a>
and the R package <a href="https://cran.r-project.org/package=maxnet" class="external-link"><code>maxnet</code></a>,
but <code>ENMeval</code> 2.0.x offers functionality for adding and
customizing the implementations of ENM algorithms and their evaluations.
This new version also features automatic generation of metadata, a null
model for calculating effect size and significance of performance
metrics, various plotting tools, options for parallel computing, and
more.<br>
In this updated vignette, we detail a full ENM analysis: acquisition and
processing of input data, sampling background data, deciding on
partitioning methods, tuning models, examining results and selecting
optimal model settings, building null models to test for significance of
performance metrics, and more using <code>ENMeval</code> 2.0.x and other
relevant R packages. In addition to this vignette, there are other
excellent tutorials on ENMs, some of which can be found in the <a href="#resources">References and Resources</a> section.</p>
</div>
<div class="section level2">
<h2 id="data">Data Acquisition &amp; Pre-processing<a class="anchor" aria-label="anchor" href="#data"></a>
</h2>
<p>We’ll start by downloading an occurrence dataset for <a href="https://en.wikipedia.org/wiki/Brown-throated_sloth" class="external-link"><em>Bradypus
variegatus</em></a>, the brown-throated sloth. Along the way, if you
notice you cannot load a particular package, simply install it with
<code>install.packages</code>, then try <code>library</code> again.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load packages -- the order here is important because some pkg functions overwrite others.</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://jamiemkass.github.io/ENMeval/">ENMeval</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">geodata</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-gis.net/" class="external-link">usdm</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rvalavi/blockCV" class="external-link">blockCV</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/" class="external-link">tibble</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/" class="external-link">knitr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set a random seed in order to be able to reproduce this analysis.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">48</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># You can search online databases like GBIF using the spocc package (commented below),</span></span>
<span><span class="co"># but here we will load in some pre-downloaded data.</span></span>
<span><span class="co"># bv &lt;- spocc::occ('Bradypus variegatus', 'gbif', limit=300, has_coords = TRUE)</span></span>
<span><span class="co"># occs &lt;- as.data.frame(bv$gbif$data$Bradypus_variegatus[,2:3])</span></span>
<span><span class="va">occs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/serialize.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"bvariegatus.rds"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Removing occurrences that have the same coordinates is good practice to</span></span>
<span><span class="co"># avoid pseudoreplication.</span></span>
<span><span class="va">occs</span> <span class="op">&lt;-</span> <span class="va">occs</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">duplicated</a></span><span class="op">(</span><span class="va">occs</span><span class="op">)</span>,<span class="op">]</span></span></code></pre></div>
<p>We are going to model the climatic niche suitability for our focal
species using long-term summarized climate data from <a href="http://www.worldclim.org/" class="external-link">WorldClim 2.1</a>. WorldClim has a
range of variables available at various resolutions; for simplicity,
here we’ll use the 19 bioclimatic variables at 5 arcmin resolution
(about 10 km across at the equator) downloadable using the
<code>geodata</code> package. Many of these variables are often highly
correlated, and modeling with correlated variables can lead to
inaccurate results (even with machine-learning methods that are robust
to collinearity), so we will remove those with the highest variance
inflation factor (VIF), a measure of variable correlation.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Download global raster data for bioclimatic variables from WorldClim 2.1, then</span></span>
<span><span class="co"># simplify their names and crop them to our extent of interest.</span></span>
<span><span class="co"># Find the descriptions of the bioclimatic variables here: </span></span>
<span><span class="co"># https://www.worldclim.org/data/bioclim.html</span></span>
<span><span class="va">envs</span> <span class="op">&lt;-</span> <span class="fu">geodata</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/geodata/man/worldclim.html" class="external-link">worldclim_global</a></span><span class="op">(</span>var <span class="op">=</span> <span class="st">"bio"</span>, res <span class="op">=</span> <span class="fl">5</span>, path <span class="op">=</span> <span class="st">"."</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">envs</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"bio"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">19</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span><span class="va">extent</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/ext.html" class="external-link">ext</a></span><span class="op">(</span><span class="op">-</span><span class="fl">125</span>, <span class="op">-</span><span class="fl">32</span>, <span class="op">-</span><span class="fl">56</span>, <span class="fl">40</span><span class="op">)</span></span>
<span><span class="va">envs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/crop.html" class="external-link">crop</a></span><span class="op">(</span><span class="va">envs</span>, <span class="va">extent</span><span class="op">)</span></span>
<span><span class="co"># Now we will remove those variables from consideration that have a high VIF.</span></span>
<span><span class="va">envs.vif</span> <span class="op">&lt;-</span> <span class="fu">usdm</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/usdm/man/vif.html" class="external-link">vifstep</a></span><span class="op">(</span><span class="va">envs</span><span class="op">)</span></span>
<span><span class="va">envs.rem</span> <span class="op">&lt;-</span> <span class="va">envs.vif</span><span class="op">@</span><span class="va">excluded</span></span>
<span><span class="va">envs</span> <span class="op">&lt;-</span> <span class="va">envs</span><span class="op">[[</span><span class="op">!</span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">envs</span><span class="op">)</span> <span class="op"><a href="https://rspatial.github.io/terra/reference/match.html" class="external-link">%in%</a></span> <span class="va">envs.rem</span><span class="op">)</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Let's now remove occurrences that are cell duplicates -- these are</span></span>
<span><span class="co"># occurrences that share a grid cell in the predictor variable rasters.</span></span>
<span><span class="co"># Although Maxent does this by default, keep in mind that for other algorithms you may</span></span>
<span><span class="co"># or may not want to do this based on the aims of your study.</span></span>
<span><span class="co"># Another way to space occurrence records a defined distance from each other to avoid</span></span>
<span><span class="co"># spatial autocorrelation is with spatial thinning (Aiello-Lammens et al. 2015).</span></span>
<span><span class="va">occs.cells</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/extract.html" class="external-link">extract</a></span><span class="op">(</span><span class="va">envs</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="va">occs</span>, cellnumbers <span class="op">=</span> <span class="cn">TRUE</span>, ID <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">occs.cellDups</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">duplicated</a></span><span class="op">(</span><span class="va">occs.cells</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">occs</span> <span class="op">&lt;-</span> <span class="va">occs</span><span class="op">[</span><span class="op">!</span><span class="va">occs.cellDups</span>,<span class="op">]</span></span>
<span></span>
<span><span class="co"># Plot first raster in the stack, the mean annual temperature.</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">envs</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, main<span class="op">=</span><span class="st">"Mean annual temperature"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add points for all the occurrence points onto the raster.</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/lines.html" class="external-link">points</a></span><span class="op">(</span><span class="va">occs</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># There are some points east of the Amazon River.</span></span>
<span><span class="co"># Suppose we know this is a population that we don't want to include in the model.</span></span>
<span><span class="co"># We can remove these points from the analysis by subsetting the occurrences by </span></span>
<span><span class="co"># latitude and longitude.</span></span>
<span><span class="va">occs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">occs</span>, <span class="va">latitude</span> <span class="op">&gt;</span> <span class="op">-</span><span class="fl">20</span>, <span class="va">longitude</span> <span class="op">&lt;</span> <span class="op">-</span><span class="fl">45</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot the subsetted occurrences to make sure we filtered correctly.</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/lines.html" class="external-link">points</a></span><span class="op">(</span><span class="va">occs</span><span class="op">)</span></span></code></pre></div>
<p><img src="ENMeval-2.0-vignette_files/figure-html/envDownload-1.png" width="672"></p>
<p>Now let’s take a look at which areas of this extent are climatically
different with respect to the areas associated with the occurrence
points. To do this, we’ll use the Multivariate Environmental Similarity
surface, or MESS (Elith et al. 2010). Higher positive values indicate
increasing similarity, while higher negative values indicate
dissimilarity. Other methods besides MESS have also been proposed and
warrant exploration (e.g., Owens et al. 2013, Mesgaran et al. 2014).
This is important to investigate when considering model transfer to
other times or places, as environments that are extremely dissimilar to
those used to train the model in the present can result in projections
with high uncertainty (Wenger &amp; Olden 2012, Wright et al. 2015,
Soley-Guardia 2019).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># First we extract the climatic variable values at the occurrence points -- </span></span>
<span><span class="co"># these values are our "reference". Let's first remove the occurrences with</span></span>
<span><span class="co"># NA values for our environmental variable rasters.</span></span>
<span><span class="va">occs.z</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/extract.html" class="external-link">extract</a></span><span class="op">(</span><span class="va">envs</span>, <span class="va">occs</span>, ID <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">occs.na</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rowSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">occs.z</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">occs</span> <span class="op">&lt;-</span> <span class="va">occs</span><span class="op">[</span><span class="op">-</span><span class="va">occs.na</span>,<span class="op">]</span></span>
<span><span class="va">occs.z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/na.omit.html" class="external-link">na.omit</a></span><span class="op">(</span><span class="va">occs.z</span><span class="op">)</span></span>
<span><span class="co"># Now we use the mess() function from the predicts pkg to calculate </span></span>
<span><span class="co"># environmental similarity metrics of our predictor variable extent compared to </span></span>
<span><span class="co"># the reference points.</span></span>
<span><span class="va">occs.mess</span> <span class="op">&lt;-</span> <span class="fu">predicts</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/predicts/man/mess.html" class="external-link">mess</a></span><span class="op">(</span><span class="va">envs</span>, <span class="va">occs.z</span><span class="op">)</span></span>
<span><span class="co"># This is the MESS plot -- increasingly negative values represent increasingly different </span></span>
<span><span class="co"># climatic conditions from the reference (our occurrences), while increasingly positive </span></span>
<span><span class="co"># values are more similar.</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">occs.mess</span>, main <span class="op">=</span> <span class="st">"Environmental similarity"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/lines.html" class="external-link">points</a></span><span class="op">(</span><span class="va">occs</span><span class="op">)</span></span></code></pre></div>
<p><img src="ENMeval-2.0-vignette_files/figure-html/unnamed-chunk-1-1.png" width="672"></p>
<p>Since our models will compare the environment at occurrence
localities to the environment at background localities, we need to
sample random points from a background extent. Now we will specify the
study extent that defines where we sample background data by cropping
our global predictor variable rasters to a smaller region. To help
ensure we do not include areas that are suitable for our species but are
unoccupied due to limitations like dispersal constraints, we will
conservatively define the background extent as an area surrounding our
occurrence localities (VanDerWal et al. 2009, Merow et al. 2013). We
will do this by buffering a bounding box that includes all occurrence
localities. Some other methods of background extent delineation (e.g.,
minimum convex hulls) are more conservative because they better
characterize the geographic space holding the points. In any case, this
is one of the many things that you will need to carefully consider for
your own study.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># We'll now experiment with a different spatial R package called sf (simple features).</span></span>
<span><span class="co"># Let's make our occs into a sf object -- as the coordinate reference system (crs) for these </span></span>
<span><span class="co"># points is WGS84, a geographic crs (lat/lon) and the same as our envs rasters, we specify it </span></span>
<span><span class="co"># as the SpatRaster's crs.</span></span>
<span><span class="va">occs.sf</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">occs</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"longitude"</span>,<span class="st">"latitude"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">envs</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Now, we project our point data to an equal-area projection, which converts our </span></span>
<span><span class="co"># degrees to meters, which is ideal for buffering (the next step). </span></span>
<span><span class="co"># We use the typical Eckert IV projection.</span></span>
<span><span class="va">eckertIV</span> <span class="op">&lt;-</span> <span class="st">"+proj=eck4 +lon_0=0 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs"</span></span>
<span><span class="va">occs.sf</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">occs.sf</span>, crs <span class="op">=</span> <span class="va">eckertIV</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Buffer all occurrences by 500 km, union the polygons together </span></span>
<span><span class="co"># (for visualization), and convert back to a form that the terra package </span></span>
<span><span class="co"># can use. Finally, we reproject the buffers back to WGS84 (lat/lon).</span></span>
<span><span class="co"># We choose 500 km here to avoid sampling the Caribbean islands.</span></span>
<span><span class="va">occs.buf</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_buffer</a></span><span class="op">(</span><span class="va">occs.sf</span>, dist <span class="op">=</span> <span class="fl">500000</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_combine.html" class="external-link">st_union</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/sf.html" class="external-link">st_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span>crs <span class="op">=</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">envs</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">envs</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, main <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">envs</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/lines.html" class="external-link">points</a></span><span class="op">(</span><span class="va">occs</span><span class="op">)</span></span>
<span><span class="co"># To add sf objects to a plot, use add = TRUE</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">occs.buf</span>, border <span class="op">=</span> <span class="st">"blue"</span>, lwd <span class="op">=</span> <span class="fl">3</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="ENMeval-2.0-vignette_files/figure-html/backgExt-1.png" width="672"></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Crop environmental rasters to match the study extent</span></span>
<span><span class="va">envs.bg</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/crop.html" class="external-link">crop</a></span><span class="op">(</span><span class="va">envs</span>, <span class="va">occs.buf</span><span class="op">)</span></span>
<span><span class="co"># Next, mask the rasters to the shape of the buffers</span></span>
<span><span class="va">envs.bg</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/mask.html" class="external-link">mask</a></span><span class="op">(</span><span class="va">envs.bg</span>, <span class="va">occs.buf</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">envs.bg</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, main <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">envs</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/lines.html" class="external-link">points</a></span><span class="op">(</span><span class="va">occs</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">occs.buf</span>, border <span class="op">=</span> <span class="st">"blue"</span>, lwd <span class="op">=</span> <span class="fl">3</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="ENMeval-2.0-vignette_files/figure-html/backgExt-2.png" width="672"></p>
<p>In the next step, we’ll sample 10,000 random points from the
background (note that the number of background points is also a
consideration you should make with respect to your own study).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Randomly sample 10,000 background points from one background extent raster </span></span>
<span><span class="co"># (only one per cell without replacement). </span></span>
<span><span class="va">bg</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/sample.html" class="external-link">spatSample</a></span><span class="op">(</span><span class="va">envs.bg</span>, size <span class="op">=</span> <span class="fl">10000</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                        values <span class="op">=</span> <span class="cn">FALSE</span>, xy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">bg</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">occs</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Notice how we have pretty good coverage (every cell).</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">envs.bg</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/lines.html" class="external-link">points</a></span><span class="op">(</span><span class="va">bg</span>, pch <span class="op">=</span> <span class="fl">20</span>, cex <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></span></code></pre></div>
<p><img src="ENMeval-2.0-vignette_files/figure-html/backgPts-1.png" width="672"></p>
</div>
<div class="section level2">
<h2 id="partition">Partitioning Occurrences for Evaluation<a class="anchor" aria-label="anchor" href="#partition"></a>
</h2>
<p>A run of <code>ENMevaluate</code> begins by using one of seven
methods to partition occurrence localities into validation and training
bins (folds) for <em>k</em>-fold cross-validation (Fielding &amp; Bell
1997, Hastie et al. 2009, Peterson et al. 2011). Data partitioning is
done internally by <code>ENMevaluate</code> based on what the user
inputs for the <code>partitions</code> argument, but this can also be
done externally using the partitioning functions. In this section, we
explain and illustrate these different functions. We also demonstrate
how to make informative plots of partitions and the environmental
similarity of partitions to the background or study extent.</p>
<ol style="list-style-type: decimal">
<li><a href="#block">Spatial Block</a></li>
<li><a href="#cb1">Spatial Checkerboard</a></li>
<li><a href="#cb2">Spatial Hierarchical Checkerboard</a></li>
<li><a href="#jack">Jackknife (leave-one-out)</a></li>
<li><a href="#rand">Random <em>k</em>-fold</a></li>
<li><a href="#testing">Fully Withheld Testing Data</a></li>
<li><a href="#user">User</a></li>
</ol>
<p>The first three partitioning methods are variations of what
Radosavljevic and Anderson (2014) referred to as ‘masked geographically
structured’ data partitioning. Basically, these methods partition both
occurrence and background records into evaluation bins based on spatial
rules. The intention is to reduce spatial-autocorrelation between points
that are included in the validation and training bins, which can
overinflate model performance, at least for data sets that result from
biased sampling (Veloz 2009, Wenger &amp; Olden 2012, Roberts et
al. 2017). Other spatial partitioning methods for ENMs can be found in
the R package <code>blockCV</code> (Valavi et al. 2019), which we
demonstrate below for use with <code>ENMeval</code>.</p>
<div class="section level4">
<h4 id="block">1. Block<a class="anchor" aria-label="anchor" href="#block"></a>
</h4>
<p>First, the ‘block’ method partitions data according to the latitude
and longitude lines that divide the occurrence localities into four
spatial groups of equal numbers (or as close as possible). Both
occurrence and background localities are assigned to each of the four
bins based on their position with respect to these lines – the first
direction bisects the points into two groups, and the second direction
bisects each of these further into two groups each, resulting in four
groups. The resulting object is a list of two vectors that supply the
bin designation for each occurrence and background point. In
<code>ENMeval</code> 2.0.x, users can additionally specify different
orientations for the blocking with the <code>orientation</code>
argument.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">block</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/partitions.html">get.block</a></span><span class="op">(</span><span class="va">occs</span>, <span class="va">bg</span>, orientation <span class="op">=</span> <span class="st">"lat_lon"</span><span class="op">)</span></span>
<span><span class="co"># Let's make sure that we have an even number of occurrences in each partition.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">block</span><span class="op">$</span><span class="va">occs.grp</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  1  2  3  4 </span></span>
<span><span class="co">#&gt; 45 44 45 44</span></span>
<span><span class="co"># We can plot our partitions on one of our predictor variable rasters to visualize </span></span>
<span><span class="co"># where they fall in space.</span></span>
<span><span class="co"># The ENMeval 2.0.x plotting functions use ggplot2 (Wickham 2016), a popular plotting </span></span>
<span><span class="co"># package for R with many online resources.</span></span>
<span><span class="co"># We can add to the ggplots with other ggplot functions in an additive way, making </span></span>
<span><span class="co"># these plots easily customizable.</span></span>
<span><span class="fu"><a href="../reference/evalplot.grps.html">evalplot.grps</a></span><span class="op">(</span>pts <span class="op">=</span> <span class="va">occs</span>, pts.grp <span class="op">=</span> <span class="va">block</span><span class="op">$</span><span class="va">occs.grp</span>, envs <span class="op">=</span> <span class="va">envs.bg</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Spatial block partitions: occurrences"</span><span class="op">)</span></span></code></pre></div>
<p><img src="ENMeval-2.0-vignette_files/figure-html/part.block-1.png" width="672"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># PLotting the background shows that the background extent is partitioned in a way </span></span>
<span><span class="co"># that maximizes evenness of points across the four bins, not to maximize evenness of area.</span></span>
<span><span class="fu"><a href="../reference/evalplot.grps.html">evalplot.grps</a></span><span class="op">(</span>pts <span class="op">=</span> <span class="va">bg</span>, pts.grp <span class="op">=</span> <span class="va">block</span><span class="op">$</span><span class="va">bg.grp</span>, envs <span class="op">=</span> <span class="va">envs.bg</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Spatial block partitions: background"</span><span class="op">)</span></span></code></pre></div>
<p><img src="ENMeval-2.0-vignette_files/figure-html/part.block-2.png" width="672"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># If we are curious how different the environment associated with each partition is from </span></span>
<span><span class="co"># that of all the others, we can use this function to plot histograms or rasters of MESS </span></span>
<span><span class="co"># predictions with each partition as the reference.</span></span>
<span><span class="co"># First we need to extract the predictor variable values at our occurrence and </span></span>
<span><span class="co"># background localities.</span></span>
<span><span class="va">occs.z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">occs</span>, <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/extract.html" class="external-link">extract</a></span><span class="op">(</span><span class="va">envs</span>, <span class="va">occs</span>, ID <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">bg.z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">bg</span>, <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/extract.html" class="external-link">extract</a></span><span class="op">(</span><span class="va">envs</span>, <span class="va">bg</span>, ID <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/evalplot.envSim.hist.html">evalplot.envSim.hist</a></span><span class="op">(</span>occs.z <span class="op">=</span> <span class="va">occs.z</span>, bg.z <span class="op">=</span> <span class="va">bg.z</span>, occs.grp <span class="op">=</span> <span class="va">block</span><span class="op">$</span><span class="va">occs.grp</span>, </span>
<span>                     bg.grp <span class="op">=</span> <span class="va">block</span><span class="op">$</span><span class="va">bg.grp</span>, ref.data <span class="op">=</span> <span class="st">"occs"</span><span class="op">)</span></span></code></pre></div>
<p><img src="ENMeval-2.0-vignette_files/figure-html/part.block-3.png" width="672"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Here we plot environmental similarity values for the entire extent with respect </span></span>
<span><span class="co"># to each validation group.</span></span>
<span><span class="co"># We use the bb.buf (bounding box buffer) argument to zoom in to our study extent.</span></span>
<span><span class="fu"><a href="../reference/evalplot.envSim.map.html">evalplot.envSim.map</a></span><span class="op">(</span>envs <span class="op">=</span> <span class="va">envs</span>, occs.z <span class="op">=</span> <span class="va">occs.z</span>, bg.z <span class="op">=</span> <span class="va">bg.z</span>, </span>
<span>                    occs.grp <span class="op">=</span> <span class="va">block</span><span class="op">$</span><span class="va">occs.grp</span>, bg.grp <span class="op">=</span> <span class="va">block</span><span class="op">$</span><span class="va">bg.grp</span>, </span>
<span>                    ref.data <span class="op">=</span> <span class="st">"occs"</span>, bb.buf <span class="op">=</span> <span class="fl">7</span><span class="op">)</span></span></code></pre></div>
<p><img src="ENMeval-2.0-vignette_files/figure-html/part.block-4.png" width="672"></p>
</div>
<div class="section level4">
<h4 id="cb1">2. Basic checkerboard<a class="anchor" aria-label="anchor" href="#cb1"></a>
</h4>
<p>The next two partitioning methods are variants of a checkerboard
approach to partition occurrence localities (Radosavljevic &amp;
Anderson 2014). These generate checkerboard grids across the study
extent and partition the localities into groups based on where they fall
on the checkerboard. In contrast to the block method, both checkerboard
methods subdivide geographic space equally but do not ensure a balanced
number of occurrence localities in each bin. For these methods, the user
needs to provide a raster layer on which to base the underlying
checkerboard pattern. Here we simply use the predictor variable
SpatRaster. Additionally, the user needs to define an
<em>aggregation.factor</em>. This value specifies the number of grids
cells to aggregate when making the underlying checkerboard pattern.</p>
<p>The basic checkerboard method partitions the points into <em>k</em> =
2 spatial groups using a simple checkerboard pattern.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cb1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/partitions.html">get.checkerboard</a></span><span class="op">(</span><span class="va">occs</span>, <span class="va">envs.bg</span>, <span class="va">bg</span>, aggregation.factor <span class="op">=</span> <span class="fl">25</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/evalplot.grps.html">evalplot.grps</a></span><span class="op">(</span>pts <span class="op">=</span> <span class="va">occs</span>, pts.grp <span class="op">=</span> <span class="va">cb1</span><span class="op">$</span><span class="va">occs.grp</span>, envs <span class="op">=</span> <span class="va">envs.bg</span><span class="op">)</span></span></code></pre></div>
<p><img src="ENMeval-2.0-vignette_files/figure-html/part.ck1-1.png" width="672"></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plotting the background points shows the checkerboard pattern clearly.</span></span>
<span><span class="fu"><a href="../reference/evalplot.grps.html">evalplot.grps</a></span><span class="op">(</span>pts <span class="op">=</span> <span class="va">bg</span>, pts.grp <span class="op">=</span> <span class="va">cb1</span><span class="op">$</span><span class="va">bg.grp</span>, envs <span class="op">=</span> <span class="va">envs.bg</span><span class="op">)</span></span></code></pre></div>
<p><img src="ENMeval-2.0-vignette_files/figure-html/part.ck1-2.png" width="672"></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># We can see from the MESS maps that this method results in similar environmental </span></span>
<span><span class="co"># representation between the partitions.</span></span>
<span><span class="fu"><a href="../reference/evalplot.envSim.hist.html">evalplot.envSim.hist</a></span><span class="op">(</span>occs.z <span class="op">=</span> <span class="va">occs.z</span>, bg.z <span class="op">=</span> <span class="va">bg.z</span>, occs.grp <span class="op">=</span> <span class="va">cb1</span><span class="op">$</span><span class="va">occs.grp</span>, </span>
<span>                     bg.grp <span class="op">=</span> <span class="va">cb1</span><span class="op">$</span><span class="va">bg.grp</span>, ref.data <span class="op">=</span> <span class="st">"occs"</span><span class="op">)</span></span></code></pre></div>
<p><img src="ENMeval-2.0-vignette_files/figure-html/part.ck1-3.png" width="672"></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/evalplot.envSim.map.html">evalplot.envSim.map</a></span><span class="op">(</span>envs <span class="op">=</span> <span class="va">envs</span>, occs.z <span class="op">=</span> <span class="va">occs.z</span>, bg.z <span class="op">=</span> <span class="va">bg.z</span>, </span>
<span>                    occs.grp <span class="op">=</span> <span class="va">cb1</span><span class="op">$</span><span class="va">occs.grp</span>, bg.grp <span class="op">=</span> <span class="va">cb1</span><span class="op">$</span><span class="va">bg.grp</span>, </span>
<span>                    ref.data <span class="op">=</span> <span class="st">"occs"</span>, bb.buf <span class="op">=</span> <span class="fl">7</span><span class="op">)</span></span></code></pre></div>
<p><img src="ENMeval-2.0-vignette_files/figure-html/unnamed-chunk-2-1.png" width="672"></p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># We can increase the aggregation factor to give the groups bigger boxes.</span></span>
<span><span class="co"># This can result in groups that are more environmentally different from each other.</span></span>
<span><span class="va">cb1.large</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/partitions.html">get.checkerboard</a></span><span class="op">(</span><span class="va">occs</span>, <span class="va">envs.bg</span>, <span class="va">bg</span>, aggregation.factor <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/evalplot.grps.html">evalplot.grps</a></span><span class="op">(</span>pts <span class="op">=</span> <span class="va">occs</span>, pts.grp <span class="op">=</span> <span class="va">cb1.large</span><span class="op">$</span><span class="va">occs.grp</span>, envs <span class="op">=</span> <span class="va">envs.bg</span><span class="op">)</span></span></code></pre></div>
<p><img src="ENMeval-2.0-vignette_files/figure-html/unnamed-chunk-3-1.png" width="672"></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/evalplot.grps.html">evalplot.grps</a></span><span class="op">(</span>pts <span class="op">=</span> <span class="va">bg</span>, pts.grp <span class="op">=</span> <span class="va">cb1.large</span><span class="op">$</span><span class="va">bg.grp</span>, envs <span class="op">=</span> <span class="va">envs.bg</span><span class="op">)</span></span></code></pre></div>
<p><img src="ENMeval-2.0-vignette_files/figure-html/unnamed-chunk-3-2.png" width="672"></p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/evalplot.envSim.hist.html">evalplot.envSim.hist</a></span><span class="op">(</span>occs.z <span class="op">=</span> <span class="va">occs.z</span>, bg.z <span class="op">=</span> <span class="va">bg.z</span>, </span>
<span>                     occs.grp <span class="op">=</span> <span class="va">cb1.large</span><span class="op">$</span><span class="va">occs.grp</span>, bg.grp <span class="op">=</span> <span class="va">cb1</span><span class="op">$</span><span class="va">bg.grp</span>, </span>
<span>                     ref.data <span class="op">=</span> <span class="st">"occs"</span><span class="op">)</span></span></code></pre></div>
<p><img src="ENMeval-2.0-vignette_files/figure-html/unnamed-chunk-3-3.png" width="672"></p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/evalplot.envSim.map.html">evalplot.envSim.map</a></span><span class="op">(</span>envs <span class="op">=</span> <span class="va">envs</span>, occs.z <span class="op">=</span> <span class="va">occs.z</span>, bg.z <span class="op">=</span> <span class="va">bg.z</span>, </span>
<span>                    occs.grp <span class="op">=</span> <span class="va">cb1.large</span><span class="op">$</span><span class="va">occs.grp</span>, bg.grp <span class="op">=</span> <span class="va">cb1</span><span class="op">$</span><span class="va">bg.grp</span>, </span>
<span>                    ref.data <span class="op">=</span> <span class="st">"occs"</span>, bb.buf <span class="op">=</span> <span class="fl">7</span><span class="op">)</span></span></code></pre></div>
<p><img src="ENMeval-2.0-vignette_files/figure-html/unnamed-chunk-4-1.png" width="672"></p>
</div>
<div class="section level4">
<h4 id="cb2">3. Hierarchical checkerboard<a class="anchor" aria-label="anchor" href="#cb2"></a>
</h4>
<p>The hierarchical checkerboard method partitions the data into
<em>k</em> = 4 spatial groups. This is done by inputting two aggregation
factors to hierarchically aggregate the input raster at two scales.
Presence and background groups are assigned based on which box they fall
into on the hierarchical checkerboard.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cb2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/partitions.html">get.checkerboard</a></span><span class="op">(</span><span class="va">occs</span>, <span class="va">envs.bg</span>, <span class="va">bg</span>, aggregation.factor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/evalplot.grps.html">evalplot.grps</a></span><span class="op">(</span>pts <span class="op">=</span> <span class="va">occs</span>, pts.grp <span class="op">=</span> <span class="va">cb2</span><span class="op">$</span><span class="va">occs.grp</span>, envs <span class="op">=</span> <span class="va">envs.bg</span><span class="op">)</span></span></code></pre></div>
<p><img src="ENMeval-2.0-vignette_files/figure-html/part.ck2-1.png" width="672"></p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plotting the background points shows the checkerboard pattern very clearly.</span></span>
<span><span class="fu"><a href="../reference/evalplot.grps.html">evalplot.grps</a></span><span class="op">(</span>pts <span class="op">=</span> <span class="va">bg</span>, pts.grp <span class="op">=</span> <span class="va">cb2</span><span class="op">$</span><span class="va">bg.grp</span>, envs <span class="op">=</span> <span class="va">envs.bg</span><span class="op">)</span></span></code></pre></div>
<p><img src="ENMeval-2.0-vignette_files/figure-html/part.ck2-2.png" width="672"></p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Different from basic checkerboard, some partitions here do show some difference</span></span>
<span><span class="co"># in environmental representation, but not as consistently different as with block.</span></span>
<span><span class="fu"><a href="../reference/evalplot.envSim.hist.html">evalplot.envSim.hist</a></span><span class="op">(</span>occs.z <span class="op">=</span> <span class="va">occs.z</span>, bg.z <span class="op">=</span> <span class="va">bg.z</span>, occs.grp <span class="op">=</span> <span class="va">cb2</span><span class="op">$</span><span class="va">occs.grp</span>, </span>
<span>                     bg.grp <span class="op">=</span> <span class="va">cb2</span><span class="op">$</span><span class="va">bg.grp</span>, ref.data <span class="op">=</span> <span class="st">"occs"</span><span class="op">)</span></span></code></pre></div>
<p><img src="ENMeval-2.0-vignette_files/figure-html/part.ck2-3.png" width="672"></p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/evalplot.envSim.map.html">evalplot.envSim.map</a></span><span class="op">(</span>envs <span class="op">=</span> <span class="va">envs</span>, occs.z <span class="op">=</span> <span class="va">occs.z</span>, bg.z <span class="op">=</span> <span class="va">bg.z</span>, </span>
<span>                    occs.grp <span class="op">=</span> <span class="va">cb2</span><span class="op">$</span><span class="va">occs.grp</span>, bg.grp <span class="op">=</span> <span class="va">cb2</span><span class="op">$</span><span class="va">bg.grp</span>, </span>
<span>                    ref.data <span class="op">=</span> <span class="st">"occs"</span>, bb.buf <span class="op">=</span> <span class="fl">7</span><span class="op">)</span></span></code></pre></div>
<p><img src="ENMeval-2.0-vignette_files/figure-html/part.ck2-4.png" width="672"></p>
</div>
<div class="section level4">
<h4 id="jack">4. Jackknife (leave-one-out)<a class="anchor" aria-label="anchor" href="#jack"></a>
</h4>
<p>The next two methods differ from the first three in that (a) they do
not partition the background points into different groups (meaning that
the full background is used to evaluate each partition), and (b) they do
not account for spatial autocorrelation between validation and training
localities. Primarily when working with relatively small data sets
(e.g. &lt; ca. 25 presence localities), users may choose a special case
of <em>k</em>-fold cross-validation where the number of bins
(<em>k</em>) is equal to the number of occurrence localities
(<em>n</em>) in the data set (Pearson et al. 2007; Shcheglovitova &amp;
Anderson 2013). This is referred to as jackknife, or leave-one-out,
partitioning (Hastie et al. 2009). As <em>n</em> models are processed
with this partitioning method, the computation time could be long for
large occurrence datasets.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">jack</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/partitions.html">get.jackknife</a></span><span class="op">(</span><span class="va">occs</span>, <span class="va">bg</span><span class="op">)</span></span>
<span><span class="co"># If the number of input points is larger than 10, the legend for the groups </span></span>
<span><span class="co"># is suppressed.</span></span>
<span><span class="fu"><a href="../reference/evalplot.grps.html">evalplot.grps</a></span><span class="op">(</span>pts <span class="op">=</span> <span class="va">occs</span>, pts.grp <span class="op">=</span> <span class="va">jack</span><span class="op">$</span><span class="va">occs.grp</span>, envs <span class="op">=</span> <span class="va">envs.bg</span><span class="op">)</span></span></code></pre></div>
<p><img src="ENMeval-2.0-vignette_files/figure-html/part.jk-1.png" width="672"></p>
</div>
<div class="section level4">
<h4 id="rand">5. Random k-fold<a class="anchor" aria-label="anchor" href="#rand"></a>
</h4>
<p>The ‘random k-fold’ method partitions occurrence localities randomly
into a user-specified number of (<em>k</em>) bins (Hastie et al. 2009).
This method is equivalent to the ‘cross-validate’ partitioning scheme
available in the current version of the Maxent software GUI. Especially
with larger occurrence datasets, this partitioning method could randomly
result in some spatial clustering of groups, which is why spatial
partitioning methods are preferable for addressing spatial
autocorrelation (Roberts et al. 2017). Below, we partition the data into
five random groups.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rand</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/partitions.html">get.randomkfold</a></span><span class="op">(</span><span class="va">occs</span>, <span class="va">bg</span>, k <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/evalplot.grps.html">evalplot.grps</a></span><span class="op">(</span>pts <span class="op">=</span> <span class="va">occs</span>, pts.grp <span class="op">=</span> <span class="va">rand</span><span class="op">$</span><span class="va">occs.grp</span>, envs <span class="op">=</span> <span class="va">envs.bg</span><span class="op">)</span></span></code></pre></div>
<p><img src="ENMeval-2.0-vignette_files/figure-html/part.rand-1.png" width="672"></p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># As the partitions are random, there is no large environmental difference between them.</span></span>
<span><span class="fu"><a href="../reference/evalplot.envSim.hist.html">evalplot.envSim.hist</a></span><span class="op">(</span>occs.z <span class="op">=</span> <span class="va">occs.z</span>, bg.z <span class="op">=</span> <span class="va">bg.z</span>, occs.grp <span class="op">=</span> <span class="va">rand</span><span class="op">$</span><span class="va">occs.grp</span>, </span>
<span>                     bg.grp <span class="op">=</span> <span class="va">rand</span><span class="op">$</span><span class="va">bg.grp</span>, ref.data <span class="op">=</span> <span class="st">"occs"</span><span class="op">)</span></span></code></pre></div>
<p><img src="ENMeval-2.0-vignette_files/figure-html/part.rand-2.png" width="672"></p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/evalplot.envSim.map.html">evalplot.envSim.map</a></span><span class="op">(</span>envs <span class="op">=</span> <span class="va">envs</span>, occs.z <span class="op">=</span> <span class="va">occs.z</span>, bg.z <span class="op">=</span> <span class="va">bg.z</span>, </span>
<span>                    occs.grp <span class="op">=</span> <span class="va">rand</span><span class="op">$</span><span class="va">occs.grp</span>, bg.grp <span class="op">=</span> <span class="va">rand</span><span class="op">$</span><span class="va">bg.grp</span>, </span>
<span>                    ref.data <span class="op">=</span> <span class="st">"occs"</span>, bb.buf <span class="op">=</span> <span class="fl">7</span><span class="op">)</span></span></code></pre></div>
<p><img src="ENMeval-2.0-vignette_files/figure-html/unnamed-chunk-5-1.png" width="672"></p>
</div>
<div class="section level4">
<h4 id="testing">6. Fully Withheld Testing Data<a class="anchor" aria-label="anchor" href="#testing"></a>
</h4>
<p>The ‘testing’ method evaluates the model on a fully withheld testing
dataset that is not used to create the full model (i.e., not included in
the training data), meaning that cross validation statistics are not
calculated. Evaluations with fully withheld testing data have been shown
to result in models with better transferability (Soley-Guardia et
al. 2019).</p>
<p>To illustrate this, we will make a table containing occurrences
representing both training data and fully withheld testing data (which
we simulate) and plot the partitions in the same way as above. However,
the testing data (group 2) will not become training data for a new
model. Instead, the training data (group 1) is used to make the model,
and the testing data (group 2) are used only to evaluate it. Thus, the
background extent does not include the testing data (a few points fall
inside this extent because of the buffer we applied, but they are not
used as training data).</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># First, let's specify a fake testing occurrence dataset and plot the testing points with </span></span>
<span><span class="co"># the rest of our data</span></span>
<span><span class="va">occs.testing</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>longitude <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">55</span>, <span class="fl">65</span><span class="op">)</span>, latitude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">10</span>, <span class="op">-</span><span class="fl">10</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/evalplot.grps.html">evalplot.grps</a></span><span class="op">(</span>pts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">occs</span>, <span class="va">occs.testing</span><span class="op">)</span>, </span>
<span>              pts.grp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">occs</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">occs.testing</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, envs <span class="op">=</span> <span class="va">envs.bg</span><span class="op">)</span></span></code></pre></div>
<p><img src="ENMeval-2.0-vignette_files/figure-html/part.ind-1.png" width="672"></p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Next, let's extract the predictor variable values for our testing points.</span></span>
<span><span class="va">occs.testing.z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">occs.testing</span>, <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/extract.html" class="external-link">extract</a></span><span class="op">(</span><span class="va">envs</span>, <span class="va">occs.testing</span>, ID <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># We use the same background groups as random partitions here because the background used </span></span>
<span><span class="co"># for testing data is also from the full study extent. We use here the occs.testing.z </span></span>
<span><span class="co"># parameter to add information for our testing localities, and we set the partitions </span></span>
<span><span class="co"># for occurrences all to zero (as no partitioning is done).</span></span>
<span><span class="fu"><a href="../reference/evalplot.envSim.hist.html">evalplot.envSim.hist</a></span><span class="op">(</span>occs.z <span class="op">=</span> <span class="va">occs.z</span>, bg.z <span class="op">=</span> <span class="va">bg.z</span>, </span>
<span>                     occs.grp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">occs</span><span class="op">)</span><span class="op">)</span>, bg.grp <span class="op">=</span> <span class="va">rand</span><span class="op">$</span><span class="va">bg.grp</span>, </span>
<span>                     ref.data <span class="op">=</span> <span class="st">"occs"</span>, occs.testing.z <span class="op">=</span> <span class="va">occs.testing.z</span><span class="op">)</span></span></code></pre></div>
<p><img src="ENMeval-2.0-vignette_files/figure-html/part.ind-2.png" width="672"></p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/evalplot.envSim.map.html">evalplot.envSim.map</a></span><span class="op">(</span>envs <span class="op">=</span> <span class="va">envs</span>, occs.z <span class="op">=</span> <span class="va">occs.z</span>, </span>
<span>                    bg.z <span class="op">=</span> <span class="va">bg.z</span>, occs.grp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">occs</span><span class="op">)</span><span class="op">)</span>, </span>
<span>                    bg.grp <span class="op">=</span> <span class="va">rand</span><span class="op">$</span><span class="va">bg.grp</span>, bb.buf <span class="op">=</span> <span class="fl">7</span>, </span>
<span>                    ref.data <span class="op">=</span> <span class="st">"occs"</span>, occs.testing.z <span class="op">=</span> <span class="va">occs.testing.z</span><span class="op">)</span></span></code></pre></div>
<p><img src="ENMeval-2.0-vignette_files/figure-html/unnamed-chunk-6-1.png" width="672"></p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># We can see what is to be expected -- the testing dataset is much more restricted </span></span>
<span><span class="co"># environmentally than the training data, and thus is much more difference with the </span></span>
<span><span class="co"># study extent.</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="user">7. User-defined<a class="anchor" aria-label="anchor" href="#user"></a>
</h4>
<p>For maximum flexibility, the last partitioning method is designed so
that users can define <em>a priori</em> partitions. This provides a
flexible way to conduct spatially-independent cross-validation with
background masking. For example, we demonstrate partitioning the
occurrence data based on <em>k</em>-means groups. The user-defined
partition option can also be used to input partition groups derived from
other sources.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Here we run a k-means clustering algorithm to group our occurrences into discrete spatial </span></span>
<span><span class="co"># groups based on their coordinates.</span></span>
<span><span class="va">grp.n</span> <span class="op">&lt;-</span> <span class="fl">6</span></span>
<span><span class="va">kmeans</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/kmeans.html" class="external-link">kmeans</a></span><span class="op">(</span><span class="va">occs</span>, <span class="va">grp.n</span><span class="op">)</span></span>
<span><span class="va">occs.grp</span> <span class="op">&lt;-</span> <span class="va">kmeans</span><span class="op">$</span><span class="va">cluster</span></span>
<span><span class="fu"><a href="../reference/evalplot.grps.html">evalplot.grps</a></span><span class="op">(</span>pts <span class="op">=</span> <span class="va">occs</span>, pts.grp <span class="op">=</span> <span class="va">occs.grp</span>, envs <span class="op">=</span> <span class="va">envs.bg</span><span class="op">)</span></span></code></pre></div>
<p><img src="ENMeval-2.0-vignette_files/figure-html/part.user1-1.png" width="672"></p>
<p>When using the user-defined partitioning method, we need to supply
<code>ENMevaluate</code> with group identifiers for both occurrence AND
background records If we want to use all background records for each
group, we can set the background to zero.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Assign all background records</span></span>
<span><span class="va">bg.grp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">bg</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/evalplot.grps.html">evalplot.grps</a></span><span class="op">(</span>pts <span class="op">=</span> <span class="va">bg</span>, pts.grp <span class="op">=</span> <span class="va">bg.grp</span>, envs <span class="op">=</span> <span class="va">envs.bg</span><span class="op">)</span></span></code></pre></div>
<p><img src="ENMeval-2.0-vignette_files/figure-html/part.user2-1.png" width="672"></p>
<p>Alternatively, we may think of various ways to partition background
data. This depends on the goals of the study but we might, for example,
find it reasonable to partition background records by assigning groups
based on distance to the centroids of the occurrence clusters.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Here we find the centers of the occurrence k-means clusters and calculate the spatial </span></span>
<span><span class="co"># distance of each background point to them. We then find which center had the minimum </span></span>
<span><span class="co"># distance for each record and assign that record to this centroid group.</span></span>
<span><span class="va">centers</span> <span class="op">&lt;-</span> <span class="va">kmeans</span><span class="op">$</span><span class="va">center</span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/distance.html" class="external-link">distance</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/coerce.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">bg</span><span class="op">)</span>, <span class="va">centers</span>, lonlat <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">bg.grp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">d</span>, <span class="fl">1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">x</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/evalplot.grps.html">evalplot.grps</a></span><span class="op">(</span>pts <span class="op">=</span> <span class="va">bg</span>, pts.grp <span class="op">=</span> <span class="va">bg.grp</span>, envs <span class="op">=</span> <span class="va">envs.bg</span><span class="op">)</span></span></code></pre></div>
<p><img src="ENMeval-2.0-vignette_files/figure-html/part.user3-1.png" width="672"></p>
<p>We can also use other packages to partition our data. As an example,
we next show how to use the R package <a href="https://CRAN.R-project.org/package=blockCV" class="external-link"><code>blockCV</code></a>
(Valavi et al. 2019) to generate spatial partitions to input into
<code>ENMevaluate</code>. We use the <code>spatialBlock</code> function
to generate blocks similar to the checkerboard partition in
<code>ENMeval</code>, except that we choose here to select partitions
randomly over these blocks. This package offers other kinds of block
partitioning methods as well. Using other packages in this way expands
the variety of partitions you can use to evaluate models in
<code>ENMeval</code>, and we highly encourage experimenting with a
plurality of tools.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># First, we convert our occurrence and background records to spatial point data with the </span></span>
<span><span class="co"># package sf and assign the correct coordinate reference system.</span></span>
<span><span class="va">occsBg.sf</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">occs</span>, <span class="va">bg</span><span class="op">)</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"longitude"</span>,<span class="st">"latitude"</span><span class="op">)</span>, </span>
<span>                          crs <span class="op">=</span> <span class="st">"+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs"</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">envs.bg</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">occsBg.sf</span><span class="op">)</span></span>
<span><span class="co"># Here, we implement the spatialBlock function from the blockCV package.</span></span>
<span><span class="co"># The required inputs are similar to ENMeval partitioning functions, but here you assign</span></span>
<span><span class="co"># the size of blocks in meters with the argument theRange (here set at 1000 km), and the </span></span>
<span><span class="co"># partition selection method can be assigned as either "checkerboard" or "random"</span></span>
<span><span class="co"># In addition, the spatialBlock function returns a map showing the different </span></span>
<span><span class="co"># spatial partitions.</span></span>
<span><span class="va">sb</span> <span class="op">&lt;-</span> <span class="fu">blockCV</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/blockCV/man/cv_spatial.html" class="external-link">cv_spatial</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">occsBg.sf</span>, r <span class="op">=</span> <span class="va">envs.bg</span>, k <span class="op">=</span> <span class="fl">5</span>, </span>
<span>                            size <span class="op">=</span> <span class="fl">1000000</span>, selection <span class="op">=</span> <span class="st">"random"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   |                                                                              |                                                                      |   0%  |                                                                              |=                                                                     |   1%  |                                                                              |=                                                                     |   2%  |                                                                              |==                                                                    |   3%  |                                                                              |===                                                                   |   4%  |                                                                              |====                                                                  |   5%  |                                                                              |====                                                                  |   6%  |                                                                              |=====                                                                 |   7%  |                                                                              |======                                                                |   8%  |                                                                              |======                                                                |   9%  |                                                                              |=======                                                               |  10%  |                                                                              |========                                                              |  11%  |                                                                              |========                                                              |  12%  |                                                                              |=========                                                             |  13%  |                                                                              |==========                                                            |  14%  |                                                                              |==========                                                            |  15%  |                                                                              |===========                                                           |  16%  |                                                                              |============                                                          |  17%  |                                                                              |=============                                                         |  18%  |                                                                              |=============                                                         |  19%  |                                                                              |==============                                                        |  20%  |                                                                              |===============                                                       |  21%  |                                                                              |===============                                                       |  22%  |                                                                              |================                                                      |  23%  |                                                                              |=================                                                     |  24%  |                                                                              |==================                                                    |  25%  |                                                                              |==================                                                    |  26%  |                                                                              |===================                                                   |  27%  |                                                                              |====================                                                  |  28%  |                                                                              |====================                                                  |  29%  |                                                                              |=====================                                                 |  30%  |                                                                              |======================                                                |  31%  |                                                                              |======================                                                |  32%  |                                                                              |=======================                                               |  33%  |                                                                              |========================                                              |  34%  |                                                                              |========================                                              |  35%  |                                                                              |=========================                                             |  36%  |                                                                              |==========================                                            |  37%  |                                                                              |===========================                                           |  38%  |                                                                              |===========================                                           |  39%  |                                                                              |============================                                          |  40%  |                                                                              |=============================                                         |  41%  |                                                                              |=============================                                         |  42%  |                                                                              |==============================                                        |  43%  |                                                                              |===============================                                       |  44%  |                                                                              |================================                                      |  45%  |                                                                              |================================                                      |  46%  |                                                                              |=================================                                     |  47%  |                                                                              |==================================                                    |  48%  |                                                                              |==================================                                    |  49%  |                                                                              |===================================                                   |  50%  |                                                                              |====================================                                  |  51%  |                                                                              |====================================                                  |  52%  |                                                                              |=====================================                                 |  53%  |                                                                              |======================================                                |  54%  |                                                                              |======================================                                |  55%  |                                                                              |=======================================                               |  56%  |                                                                              |========================================                              |  57%  |                                                                              |=========================================                             |  58%  |                                                                              |=========================================                             |  59%  |                                                                              |==========================================                            |  60%  |                                                                              |===========================================                           |  61%  |                                                                              |===========================================                           |  62%  |                                                                              |============================================                          |  63%  |                                                                              |=============================================                         |  64%  |                                                                              |==============================================                        |  65%  |                                                                              |==============================================                        |  66%  |                                                                              |===============================================                       |  67%  |                                                                              |================================================                      |  68%  |                                                                              |================================================                      |  69%  |                                                                              |=================================================                     |  70%  |                                                                              |==================================================                    |  71%  |                                                                              |==================================================                    |  72%  |                                                                              |===================================================                   |  73%  |                                                                              |====================================================                  |  74%  |                                                                              |====================================================                  |  75%  |                                                                              |=====================================================                 |  76%  |                                                                              |======================================================                |  77%  |                                                                              |=======================================================               |  78%  |                                                                              |=======================================================               |  79%  |                                                                              |========================================================              |  80%  |                                                                              |=========================================================             |  81%  |                                                                              |=========================================================             |  82%  |                                                                              |==========================================================            |  83%  |                                                                              |===========================================================           |  84%  |                                                                              |============================================================          |  85%  |                                                                              |============================================================          |  86%  |                                                                              |=============================================================         |  87%  |                                                                              |==============================================================        |  88%  |                                                                              |==============================================================        |  89%  |                                                                              |===============================================================       |  90%  |                                                                              |================================================================      |  91%  |                                                                              |================================================================      |  92%  |                                                                              |=================================================================     |  93%  |                                                                              |==================================================================    |  94%  |                                                                              |==================================================================    |  95%  |                                                                              |===================================================================   |  96%  |                                                                              |====================================================================  |  97%  |                                                                              |===================================================================== |  98%  |                                                                              |===================================================================== |  99%  |                                                                              |======================================================================| 100%</span></span>
<span><span class="co">#&gt;   train test</span></span>
<span><span class="co">#&gt; 1  8055 2123</span></span>
<span><span class="co">#&gt; 2  8170 2008</span></span>
<span><span class="co">#&gt; 3  8334 1844</span></span>
<span><span class="co">#&gt; 4  7893 2285</span></span>
<span><span class="co">#&gt; 5  8260 1918</span></span></code></pre></div>
<p><img src="ENMeval-2.0-vignette_files/figure-html/unnamed-chunk-7-1.png" width="672"></p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># We can pull out the partition information from the SpatialBlock object to assemble</span></span>
<span><span class="co"># occs.grp and bg.grp, which can be used for plotting or as user.grp inputs for ENMevaluate.</span></span>
<span><span class="va">occs.grp</span> <span class="op">&lt;-</span> <span class="va">sb</span><span class="op">$</span><span class="va">folds_ids</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">occs</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">bg.grp</span> <span class="op">&lt;-</span> <span class="va">sb</span><span class="op">$</span><span class="va">folds_ids</span><span class="op">[</span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">occs</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">sb</span><span class="op">$</span><span class="va">folds_ids</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="../reference/evalplot.grps.html">evalplot.grps</a></span><span class="op">(</span>pts <span class="op">=</span> <span class="va">bg</span>, pts.grp <span class="op">=</span> <span class="va">bg.grp</span>, envs <span class="op">=</span> <span class="va">envs.bg</span><span class="op">)</span></span></code></pre></div>
<p><img src="ENMeval-2.0-vignette_files/figure-html/unnamed-chunk-7-2.png" width="672"></p>
<p>Selecting which of these data partitioning methods to use should be
based on the research objectives and the characteristics of the study
system. Refer to the <a href="#resources">References and Resources</a>
section for studies and resources to consult for more information
concerning partitioning for model evaluation.</p>
</div>
</div>
<div class="section level2">
<h2 id="eval">Running ENMeval<a class="anchor" aria-label="anchor" href="#eval"></a>
</h2>
<p>Once we decide which method of data partitioning we would like to
use, we are ready to start building models. We now move on to the main
function in <code>ENMeval</code>: <code>ENMevaluate</code>.</p>
<div class="section level4">
<h4 id="initial-considerations">Initial considerations<a class="anchor" aria-label="anchor" href="#initial-considerations"></a>
</h4>
<p>Although any algorithm can potentially be specified in
<code>ENMeval</code> 2.0.x (see below), and the package has built-in
implementations for Maxent and BIOCLIM, we will explain here the tuning
procedure for Maxent models (either <code>maxent.jar</code> or
<code>maxnet</code>). For Maxent models (Phillips et al. 2006, Phillips
et al. 2008, Phillips et al. 2017), the two main parameters to tune when
calling <code>ENMevaluate</code> are (1) the range of regularization
multiplier values and (2) the combinations of feature classes (Elith et
al. 2011, Merow et al. 2013). The <strong><em>regularization
multiplier</em></strong> (RM) determines the penalty associated with
including variables or their transformations in the model. Higher RM
values impose a stronger penalty on model complexity and thus result in
simpler (<em>flatter</em>) model predictions. The <strong><em>feature
classes</em></strong> determine the potential shape of the marginal
response curves. A model that is only allowed to include linear feature
classes will most likely be simpler than a model that is allowed to
include all possible feature classes. A more detailed description of
these parameters is available in the <a href="#resources">References and
Resources</a> section. For the purposes of this vignette, we demonstrate
simply how to adjust these parameters. The following section deals with
comparing the outputs of each model.</p>
<p>Unless you supply the function with background points (which is
recommended in many cases), you will need to define how many background
points should be used with the <code>n.bg</code> argument. If any of
your predictor variables are categorical (e.g., like the “biomes”
variable we initially removed from this dataset), you should define
which layer(s) these are using the ‘categoricals’ argument or assign
them as factors in the SpatRaster or input table.</p>
<p><code>ENMevaluate</code> builds a separate model for each unique
combination of RM values and feature class combinations. For example,
the following call will build and evaluate 2 models. One with RM=1 and
another with RM=2, both allowing only linear features.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">e.mx.l</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ENMevaluate.html">ENMevaluate</a></span><span class="op">(</span>occs <span class="op">=</span> <span class="va">occs</span>, envs <span class="op">=</span> <span class="va">envs</span>, bg <span class="op">=</span> <span class="va">bg</span>, </span>
<span>                      algorithm <span class="op">=</span> <span class="st">'maxnet'</span>, partitions <span class="op">=</span> <span class="st">'block'</span>, </span>
<span>                      tune.args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fc <span class="op">=</span> <span class="st">"L"</span>, rm <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">e.mx.l</span></span>
<span><span class="co">#&gt; An object of class:  ENMevaluation </span></span>
<span><span class="co">#&gt;  occurrence/background points:  178 / 10000 </span></span>
<span><span class="co">#&gt;  partition method:  block </span></span>
<span><span class="co">#&gt;  partition settings:  orientation = lat_lon </span></span>
<span><span class="co">#&gt;  clamp:  left: bio2, bio3, bio5, bio8, bio9, bio13, bio14, bio15, bio18, bio19</span></span>
<span><span class="co">#&gt;          right: bio2, bio3, bio5, bio8, bio9, bio13, bio14, bio15, bio18, bio19 </span></span>
<span><span class="co">#&gt;  categoricals:   </span></span>
<span><span class="co">#&gt;  algorithm:  maxnet </span></span>
<span><span class="co">#&gt;  tune settings:  fc: L</span></span>
<span><span class="co">#&gt;                  rm: 1,2 </span></span>
<span><span class="co">#&gt;  overlap:  TRUE </span></span>
<span><span class="co">#&gt; Refer to ?ENMevaluation for information on slots.</span></span></code></pre></div>
<p>We may, however, want to compare a wider range of models that can use
a wider variety of feature classes and regularization multipliers:</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tune.args</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"L"</span>,<span class="st">"LQ"</span>,<span class="st">"LQH"</span><span class="op">)</span>, rm <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">e.mx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ENMevaluate.html">ENMevaluate</a></span><span class="op">(</span>occs <span class="op">=</span> <span class="va">occs</span>, envs <span class="op">=</span> <span class="va">envs</span>, bg <span class="op">=</span> <span class="va">bg</span>, </span>
<span>                    algorithm <span class="op">=</span> <span class="st">'maxnet'</span>, partitions <span class="op">=</span> <span class="st">'block'</span>, </span>
<span>                    tune.args <span class="op">=</span> <span class="va">tune.args</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">e.mx</span></span>
<span><span class="co">#&gt; An object of class:  ENMevaluation </span></span>
<span><span class="co">#&gt;  occurrence/background points:  178 / 10000 </span></span>
<span><span class="co">#&gt;  partition method:  block </span></span>
<span><span class="co">#&gt;  partition settings:  orientation = lat_lon </span></span>
<span><span class="co">#&gt;  clamp:  left: bio2, bio3, bio5, bio8, bio9, bio13, bio14, bio15, bio18, bio19</span></span>
<span><span class="co">#&gt;          right: bio2, bio3, bio5, bio8, bio9, bio13, bio14, bio15, bio18, bio19 </span></span>
<span><span class="co">#&gt;  categoricals:   </span></span>
<span><span class="co">#&gt;  algorithm:  maxnet </span></span>
<span><span class="co">#&gt;  tune settings:  fc: L,LQ,LQH</span></span>
<span><span class="co">#&gt;                  rm: 1,2,3,4,5 </span></span>
<span><span class="co">#&gt;  overlap:  TRUE </span></span>
<span><span class="co">#&gt; Refer to ?ENMevaluation for information on slots.</span></span></code></pre></div>
<p>When building many models, the function may take a long time to run.
Of course this depends on the size of your dataset and the computer you
are using. When working on big projects, running the command in parallel
(<code>parallel = TRUE</code>) can be considerably faster. Note that
running parallel can also be slower when working on small datasets.</p>
<p>We can also calculate one of two niche overlap statistics while
running <code>ENMevaluate</code> by setting the arguments
<code>overlap = TRUE</code> and <code>overlapStat</code>, which support
Moran’s I or Schoener’s D (Warren et al. 2008). Note that you can also
calculate this value at a later stage using the separate
<code>calc.niche.overlap</code> function.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">overlap</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calc.niche.overlap.html">calc.niche.overlap</a></span><span class="op">(</span><span class="va">e.mx</span><span class="op">@</span><span class="va">predictions</span>, overlapStat <span class="op">=</span> <span class="st">"D"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">overlap</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span>
<span><span class="co">#&gt;             fc.L_rm.1 fc.LQ_rm.1 fc.LQH_rm.1 fc.L_rm.2 fc.LQ_rm.2</span></span>
<span><span class="co">#&gt; fc.L_rm.1          NA         NA          NA        NA         NA</span></span>
<span><span class="co">#&gt; fc.LQ_rm.1  0.8887215         NA          NA        NA         NA</span></span>
<span><span class="co">#&gt; fc.LQH_rm.1 0.4973815  0.5120040          NA        NA         NA</span></span>
<span><span class="co">#&gt; fc.L_rm.2   0.9682736  0.8758681   0.5027874        NA         NA</span></span>
<span><span class="co">#&gt; fc.LQ_rm.2  0.9173979  0.9567198   0.5100648 0.9108483         NA</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="different-parameterizations">Different parameterizations<a class="anchor" aria-label="anchor" href="#different-parameterizations"></a>
</h4>
<p>There are multiple ways to run the function <code>ENMevaluate</code>,
and we will go over how to specify each parameterization and what the
effects are on the results.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># If maxent.jar is installed and rJava loads properly, you can also run Maxent with </span></span>
<span><span class="co"># the original Java software.</span></span>
<span><span class="va">e.mxjar</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ENMevaluate.html">ENMevaluate</a></span><span class="op">(</span><span class="va">occs</span>, <span class="va">envs</span>, <span class="va">bg</span>, algorithm <span class="op">=</span> <span class="st">"maxent.jar"</span>, </span>
<span>                       tune.args <span class="op">=</span> <span class="va">tune.args</span>, partitions <span class="op">=</span> <span class="st">"block"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 2. Testing partition: no cross validation statistics calculated; instead, model will be </span></span>
<span><span class="co"># evaluated on a testing dataset that is not used to create the full model.</span></span>
<span><span class="va">e.test</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ENMevaluate.html">ENMevaluate</a></span><span class="op">(</span><span class="va">occs</span>, <span class="va">envs</span>, <span class="va">bg</span>, algorithm <span class="op">=</span> <span class="st">"maxnet"</span>, </span>
<span>                      tune.args <span class="op">=</span> <span class="va">tune.args</span>, partitions <span class="op">=</span> <span class="st">"testing"</span>, </span>
<span>                      occs.testing <span class="op">=</span> <span class="va">occs.testing</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 3. User partitions.</span></span>
<span><span class="va">user.grp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>occs.grp <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/math-generics.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">occs</span><span class="op">)</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>, </span>
<span>                 bg.grp <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/math-generics.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">bg</span><span class="op">)</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">e.user</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ENMevaluate.html">ENMevaluate</a></span><span class="op">(</span><span class="va">occs</span>, <span class="va">envs</span>, <span class="va">bg</span>, algorithm <span class="op">=</span> <span class="st">"maxnet"</span>, </span>
<span>                      tune.args <span class="op">=</span> <span class="va">tune.args</span>, partitions <span class="op">=</span> <span class="st">"user"</span>, </span>
<span>                      user.grp <span class="op">=</span> <span class="va">user.grp</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 4. No partitions: no cross validation statistics calculated, nor any model </span></span>
<span><span class="co"># evaluation on test data.</span></span>
<span><span class="va">e.noCV</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ENMevaluate.html">ENMevaluate</a></span><span class="op">(</span><span class="va">occs</span>, <span class="va">envs</span>, <span class="va">bg</span>, algorithm <span class="op">=</span> <span class="st">"maxnet"</span>, </span>
<span>                      tune.args <span class="op">=</span> <span class="va">tune.args</span>, partitions <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 5. No raster data (a.k.a, samples with data, or SWD): no full model raster predictions </span></span>
<span><span class="co"># created, so will run faster; also, both cbi.train and cbi.val will be calculated on the </span></span>
<span><span class="co"># point data (training and validation background) instead of on the "envs" rasters (default).</span></span>
<span><span class="co"># For this implementation, assigning categorical variables to factor with the argument </span></span>
<span><span class="co"># "categoricals" is easier, as ENMevaluate internally assigns the levels based on both </span></span>
<span><span class="co"># occs and bg, avoiding any errors associated with different factor levels when combining data.</span></span>
<span><span class="va">occs.z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">occs</span>, <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/extract.html" class="external-link">extract</a></span><span class="op">(</span><span class="va">envs</span>, <span class="va">occs</span>, ID <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">bg.z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">bg</span>, <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/extract.html" class="external-link">extract</a></span><span class="op">(</span><span class="va">envs</span>, <span class="va">bg</span>, ID <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">e.swd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ENMevaluate.html">ENMevaluate</a></span><span class="op">(</span><span class="va">occs.z</span>, bg <span class="op">=</span> <span class="va">bg.z</span>, algorithm <span class="op">=</span> <span class="st">"maxnet"</span>, </span>
<span>                     tune.args <span class="op">=</span> <span class="va">tune.args</span>, partitions <span class="op">=</span> <span class="st">"block"</span><span class="op">)</span></span></code></pre></div>
<p>You can also specify your own custom validation statistics for
<code>ENMevaluate</code> to calculate and report in the results tables.
This is done by defining a custom function that has the arguments shown
below, which are used by the internal function
<code>tune.validate</code>. Here, we add functionality to calculate the
AUC ratio and associated p-value for the partial ROC perfomance metric,
defined in (Peterson et al. 2008) and implemented by the R package
<code>kuenm</code> (Cobos et al. 2019), which is currently only
available on Github.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># First, make sure you install kuenm from Github.</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"marlonecobos/kuenm"</span><span class="op">)</span></span>
<span><span class="co"># Define a custom function that implements a performance metric not included in ENMeval.</span></span>
<span><span class="co"># The function should have a single argument "vars", which is a list that includes the </span></span>
<span><span class="co"># data most performance metrics should require -- the total list of these data can be found </span></span>
<span><span class="co"># here: ?ENMevaluate. Make sure you return a data frame that specifies the names you want to </span></span>
<span><span class="co"># see in the results tables.</span></span>
<span><span class="va">pROC</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">vars</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">pROC</span> <span class="op">&lt;-</span> <span class="fu">kuenm</span><span class="fu">::</span><span class="fu">kuenm_proc</span><span class="op">(</span><span class="va">vars</span><span class="op">$</span><span class="va">occs.val.pred</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">vars</span><span class="op">$</span><span class="va">bg.train.pred</span>, <span class="va">vars</span><span class="op">$</span><span class="va">bg.val.pred</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>pROC_auc_ratio <span class="op">=</span> <span class="va">pROC</span><span class="op">$</span><span class="va">pROC_summary</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, </span>
<span>                    pROC_pval <span class="op">=</span> <span class="va">pROC</span><span class="op">$</span><span class="va">pROC_summary</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, row.names <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Now we can run ENMevaluate with the argument "user.eval", and simply give it the </span></span>
<span><span class="co"># custom function.</span></span>
<span><span class="va">e.mx.proc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ENMevaluate.html">ENMevaluate</a></span><span class="op">(</span><span class="va">occs</span>, <span class="va">envs</span>, <span class="va">bg</span>, algorithm <span class="op">=</span> <span class="st">"maxnet"</span>, </span>
<span>                         tune.args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fc <span class="op">=</span> <span class="st">"L"</span>, rm <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span>, </span>
<span>                         partitions <span class="op">=</span> <span class="st">"block"</span>, user.eval <span class="op">=</span> <span class="va">pROC</span><span class="op">)</span></span></code></pre></div>
<p>We can see the new performance statistic averages in the
<code>results</code> slot. Notice that some model settings have NA
values for validation statistics – this is because one or more models
were NULL when built during cross-validation. If this is the case, it
means the training data used by the model (which was missing the
withheld fold) may have provided insufficient information for model
convergence given the assigned settings. Other cross-validation methods
might result in fewer model errors because they partition the data
differently. To see the model performance for all the folds, look at the
<code>results.partitions</code> slot.</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">e.mx.proc</span><span class="op">@</span><span class="va">results</span></span>
<span><span class="co">#&gt;   fc rm tune.args auc.train cbi.train auc.diff.avg auc.diff.sd auc.val.avg</span></span>
<span><span class="co">#&gt; 1  L  1 fc.L_rm.1 0.8171632     0.974    0.1344515  0.07337408   0.7261343</span></span>
<span><span class="co">#&gt; 2  L  2 fc.L_rm.2 0.8151969     0.974    0.1344432  0.07131803   0.7244877</span></span>
<span><span class="co">#&gt;   auc.val.sd cbi.val.avg cbi.val.sd or.10p.avg or.10p.sd or.mtp.avg  or.mtp.sd</span></span>
<span><span class="co">#&gt; 1  0.1376539     0.49125  0.2525079  0.2887626 0.2625836 0.02840909 0.05681818</span></span>
<span><span class="co">#&gt; 2  0.1380480     0.49400  0.2689151  0.2832071 0.2659283 0.03396465 0.05413767</span></span>
<span><span class="co">#&gt;   pROC_auc_ratio.avg pROC_auc_ratio.sd pROC_pval.avg pROC_pval.sd     AICc</span></span>
<span><span class="co">#&gt; 1           1.352866        0.08888786             0            0 3943.051</span></span>
<span><span class="co">#&gt; 2           1.340255        0.08319455             0            0 3948.874</span></span>
<span><span class="co">#&gt;   delta.AICc      w.AIC ncoef</span></span>
<span><span class="co">#&gt; 1   0.000000 0.94841315     9</span></span>
<span><span class="co">#&gt; 2   5.823047 0.05158685     7</span></span>
<span><span class="va">e.mx.proc</span><span class="op">@</span><span class="va">results.partitions</span></span>
<span><span class="co">#&gt;   tune.args fold   auc.val   auc.diff cbi.val     or.mtp    or.10p</span></span>
<span><span class="co">#&gt; 1 fc.L_rm.1    1 0.8886724 0.10205778   0.507 0.00000000 0.0000000</span></span>
<span><span class="co">#&gt; 2 fc.L_rm.1    2 0.5524341 0.24397306   0.161 0.11363636 0.6136364</span></span>
<span><span class="co">#&gt; 3 fc.L_rm.1    3 0.7218896 0.10402928   0.776 0.00000000 0.1777778</span></span>
<span><span class="co">#&gt; 4 fc.L_rm.1    4 0.7415412 0.08774573   0.521 0.00000000 0.3636364</span></span>
<span><span class="co">#&gt; 5 fc.L_rm.2    1 0.8901724 0.10232752   0.451 0.00000000 0.0000000</span></span>
<span><span class="co">#&gt; 6 fc.L_rm.2    2 0.5533381 0.24070570   0.153 0.11363636 0.6136364</span></span>
<span><span class="co">#&gt; 7 fc.L_rm.2    3 0.7128467 0.10703374   0.798 0.02222222 0.1555556</span></span>
<span><span class="co">#&gt; 8 fc.L_rm.2    4 0.7415937 0.08770597   0.574 0.00000000 0.3636364</span></span>
<span><span class="co">#&gt;   pROC_auc_ratio pROC_pval</span></span>
<span><span class="co">#&gt; 1       1.423958         0</span></span>
<span><span class="co">#&gt; 2       1.248994         0</span></span>
<span><span class="co">#&gt; 3       1.429764         0</span></span>
<span><span class="co">#&gt; 4       1.308749         0</span></span>
<span><span class="co">#&gt; 5       1.426639         0</span></span>
<span><span class="co">#&gt; 6       1.245932         0</span></span>
<span><span class="co">#&gt; 7       1.390987         0</span></span>
<span><span class="co">#&gt; 8       1.297462         0</span></span></code></pre></div>
<p>Yet another way to run <code>ENMevaluate</code> is by specifying a
new algorithm using the <code>ENMdetails</code> object. Built-in
algorithms (maxent.jar, maxnet, BIOCLIM) are implemented as
<code>ENMdetails</code> objects—they can be found in the /R folder of
the package with the file name “enm.name”, where “name” is the
algorithm. The <code>ENMdetails</code> object specifies the way
<code>ENMevaluate</code> should run the algorithm. It has some simple
functions that output 1) the algorithm’s name, 2) the function that runs
the algorithm, 3) particular messages or errors, 4) the arguments for
the model’s function, 5) a specific parameterization of the
<code>predict</code> function, 6) the number of non-zero model
coefficients, and 7) the variable importance table (if one is available
from the model object).</p>
<p>Users can construct their own <code>ENMdetails</code> object using
the built-in ones as guides. For example, a user can copy the
“enm.maxnet.R” script, modify the code to specify a different model,
save it as a new script in the /R folder with the name
“enm.myAlgorithm”, and use it to run <code>ENMevaluate</code>. To be
able to specify the model with the <code>algorithm</code> argument in
<code>ENMevaluate</code>, a small modification needs to be made to add
it to list in the <code>lookup.enm</code> internal function found in
“R/utilities.R”. We plan to work with other research groups to identify
best practices for tuning other algorithms with
presence-background/pseudoabsence data and implement new algorithms in
ENMeval in the future.</p>
</div>
<div class="section level4">
<h4 id="exploring-the-results">Exploring the results<a class="anchor" aria-label="anchor" href="#exploring-the-results"></a>
</h4>
<p>Now let’s take a look at the output from <code>ENMevaluate</code>,
which is an <code>ENMevaluation</code> object, in more detail (also see
<code><a href="../reference/ENMevaluation.html">?ENMevaluation</a></code>). It contains the following slots:</p>
<ul>
<li>
<code>algorithm</code> A character vector showing which algorithm
was used</li>
<li>
<code>tune.settings</code> A data.frame of settings that were
tuned</li>
<li>
<code>partition.method</code> A character of partitioning method
used</li>
<li>
<code>partition.settings</code> A list of partition settings used
(i.e., value of <em>k</em> or aggregation factor)</li>
<li>
<code>other.settings</code> A list of other modeling settings used
(i.e., decisions about clamping, AUC diff calculation)</li>
<li>
<code>doClamp</code> A logical indicating whether or not clamping
was used</li>
<li>
<code>clamp.directions</code> A list of the clamping directions
specified</li>
<li>
<code>results</code> A data.frame of evaluation summary
statistics</li>
<li>
<code>results.partitions</code> A data.frame of evaluation k-fold
statistics</li>
<li>
<code>models</code> A list of model objects</li>
<li>
<code>variable.importance</code> A list of data frames with variable
importance for each model (when applicable)</li>
<li>
<code>predictions</code> A SpatRaster of model predictions</li>
<li>
<code>taxon.name</code> A character for taxon name (when
specified)</li>
<li>
<code>occs</code> A data frame of the occurrence record coordinates
used for model training</li>
<li>
<code>occs.testing</code> A data frame of the coordinates of the
fully withheld testing records (when specified)</li>
<li>
<code>occs.grp</code> A vector of partition groups for occurrence
records</li>
<li>
<code>bg</code> A data frame of background record coordinates used
for model training</li>
<li>
<code>bg.grp</code> A vector of partition groups for background
records</li>
<li>
<code>overlap</code> A list of matrices of pairwise niche overlap
statistics</li>
<li>
<code>rmm</code> A list of rangeModelMetadata objects for each
model</li>
</ul>
<p>Let’s first examine the structure of the object.</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">e.mx</span></span>
<span><span class="co">#&gt; An object of class:  ENMevaluation </span></span>
<span><span class="co">#&gt;  occurrence/background points:  178 / 10000 </span></span>
<span><span class="co">#&gt;  partition method:  block </span></span>
<span><span class="co">#&gt;  partition settings:  orientation = lat_lon </span></span>
<span><span class="co">#&gt;  clamp:  left: bio2, bio3, bio5, bio8, bio9, bio13, bio14, bio15, bio18, bio19</span></span>
<span><span class="co">#&gt;          right: bio2, bio3, bio5, bio8, bio9, bio13, bio14, bio15, bio18, bio19 </span></span>
<span><span class="co">#&gt;  categoricals:   </span></span>
<span><span class="co">#&gt;  algorithm:  maxnet </span></span>
<span><span class="co">#&gt;  tune settings:  fc: L,LQ,LQH</span></span>
<span><span class="co">#&gt;                  rm: 1,2,3,4,5 </span></span>
<span><span class="co">#&gt;  overlap:  TRUE </span></span>
<span><span class="co">#&gt; Refer to ?ENMevaluation for information on slots.</span></span>
<span><span class="co"># Simplify the summary to look at higher level items.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">e.mx</span>, max.level<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; Formal class 'ENMevaluation' [package "ENMeval"] with 20 slots</span></span>
<span><span class="co">#&gt;   ..@ algorithm          : chr "maxnet"</span></span>
<span><span class="co">#&gt;   ..@ tune.settings      :'data.frame':  15 obs. of  3 variables:</span></span>
<span><span class="co">#&gt;   .. ..- attr(*, "out.attrs")=List of 2</span></span>
<span><span class="co">#&gt;   ..@ partition.method   : chr "block"</span></span>
<span><span class="co">#&gt;   ..@ partition.settings :List of 1</span></span>
<span><span class="co">#&gt;   ..@ other.settings     :List of 7</span></span>
<span><span class="co">#&gt;   ..@ doClamp            : logi TRUE</span></span>
<span><span class="co">#&gt;   ..@ clamp.directions   :List of 2</span></span>
<span><span class="co">#&gt;   ..@ results            :'data.frame':  15 obs. of  19 variables:</span></span>
<span><span class="co">#&gt;   .. ..- attr(*, "out.attrs")=List of 2</span></span>
<span><span class="co">#&gt;   ..@ results.partitions :'data.frame':  60 obs. of  7 variables:</span></span>
<span><span class="co">#&gt;   ..@ models             :List of 15</span></span>
<span><span class="co">#&gt;   ..@ variable.importance:List of 15</span></span>
<span><span class="co">#&gt;   ..@ predictions        :S4 class 'SpatRaster' [package "terra"]</span></span>
<span><span class="co">#&gt;   ..@ taxon.name         : chr ""</span></span>
<span><span class="co">#&gt;   ..@ occs               :'data.frame':  178 obs. of  12 variables:</span></span>
<span><span class="co">#&gt;   ..@ occs.testing       :'data.frame':  0 obs. of  0 variables</span></span>
<span><span class="co">#&gt;   ..@ occs.grp           : Factor w/ 4 levels "1","2","3","4": 3 3 3 1 1 1 4 4 3 1 ...</span></span>
<span><span class="co">#&gt;   ..@ bg                 :'data.frame':  10000 obs. of  12 variables:</span></span>
<span><span class="co">#&gt;   ..@ bg.grp             : Factor w/ 4 levels "1","2","3","4": 2 2 2 2 2 2 2 2 2 2 ...</span></span>
<span><span class="co">#&gt;   ..@ overlap            : list()</span></span>
<span><span class="co">#&gt;   ..@ rmm                :List of 8</span></span>
<span><span class="co">#&gt;   .. ..- attr(*, "class")= chr [1:2] "list" "RMM"</span></span></code></pre></div>
<p>We can use helper functions to access the slots in the
<code>ENMevaluation</code> object.</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Access algorithm, tuning settings, and partition method information.</span></span>
<span><span class="fu"><a href="../reference/eval.algorithm.html">eval.algorithm</a></span><span class="op">(</span><span class="va">e.mx</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "maxnet"</span></span>
<span><span class="fu"><a href="../reference/eval.tune.settings.html">eval.tune.settings</a></span><span class="op">(</span><span class="va">e.mx</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;    fc rm   tune.args</span></span>
<span><span class="co">#&gt; 1   L  1   fc.L_rm.1</span></span>
<span><span class="co">#&gt; 2  LQ  1  fc.LQ_rm.1</span></span>
<span><span class="co">#&gt; 3 LQH  1 fc.LQH_rm.1</span></span>
<span><span class="co">#&gt; 4   L  2   fc.L_rm.2</span></span>
<span><span class="co">#&gt; 5  LQ  2  fc.LQ_rm.2</span></span>
<span><span class="co">#&gt; 6 LQH  2 fc.LQH_rm.2</span></span>
<span><span class="fu"><a href="../reference/eval.partition.method.html">eval.partition.method</a></span><span class="op">(</span><span class="va">e.mx</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "block"</span></span>
<span><span class="co"># Results table with summary statistics for cross validation on test data.</span></span>
<span><span class="fu"><a href="../reference/eval.results.html">eval.results</a></span><span class="op">(</span><span class="va">e.mx</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;    fc rm   tune.args auc.train cbi.train auc.diff.avg auc.diff.sd auc.val.avg</span></span>
<span><span class="co">#&gt; 1   L  1   fc.L_rm.1 0.8171632     0.974   0.13445146  0.07337408   0.7261343</span></span>
<span><span class="co">#&gt; 2  LQ  1  fc.LQ_rm.1 0.8370413     0.976   0.12736855  0.09499498   0.7434951</span></span>
<span><span class="co">#&gt; 3 LQH  1 fc.LQH_rm.1 0.9150306     0.970   0.08607102  0.11826192   0.8111343</span></span>
<span><span class="co">#&gt; 4   L  2   fc.L_rm.2 0.8151969     0.974   0.13444323  0.07131803   0.7244877</span></span>
<span><span class="co">#&gt; 5  LQ  2  fc.LQ_rm.2 0.8329256     0.973   0.11932791  0.07414506   0.7471441</span></span>
<span><span class="co">#&gt; 6 LQH  2 fc.LQH_rm.2 0.8822739     0.938   0.09416783  0.12007184   0.7887931</span></span>
<span><span class="co">#&gt;   auc.val.sd cbi.val.avg cbi.val.sd or.10p.avg or.10p.sd or.mtp.avg  or.mtp.sd</span></span>
<span><span class="co">#&gt; 1  0.1376539     0.49125  0.2525079  0.2887626 0.2625836 0.02840909 0.05681818</span></span>
<span><span class="co">#&gt; 2  0.1438563     0.56900  0.3275352  0.2611111 0.2980209 0.05113636 0.05977172</span></span>
<span><span class="co">#&gt; 3  0.1338383     0.66400  0.2196315  0.2320707 0.1932193 0.03977273 0.05370245</span></span>
<span><span class="co">#&gt; 4  0.1380480     0.49400  0.2689151  0.2832071 0.2659283 0.03396465 0.05413767</span></span>
<span><span class="co">#&gt; 5  0.1359330     0.59425  0.2781503  0.2497475 0.2859188 0.05681818 0.06560799</span></span>
<span><span class="co">#&gt; 6  0.1438574     0.61900  0.3072599  0.2148990 0.1841122 0.05113636 0.07509177</span></span>
<span><span class="co">#&gt;       AICc delta.AICc        w.AIC ncoef</span></span>
<span><span class="co">#&gt; 1 3943.051   134.4705 6.310939e-30     9</span></span>
<span><span class="co">#&gt; 2 3913.348   104.7671 1.778705e-23    11</span></span>
<span><span class="co">#&gt; 3 4211.406   402.8254 3.369555e-88    43</span></span>
<span><span class="co">#&gt; 4 3948.874   140.2936 3.432697e-31     7</span></span>
<span><span class="co">#&gt; 5 3926.884   118.3040 2.044663e-26    12</span></span>
<span><span class="co">#&gt; 6 3808.580     0.0000 1.000000e+00    27</span></span>
<span><span class="co"># Results table with cross validation statistics for each test partition.</span></span>
<span><span class="fu"><a href="../reference/eval.results.partitions.html">eval.results.partitions</a></span><span class="op">(</span><span class="va">e.mx</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;    tune.args fold   auc.val   auc.diff cbi.val    or.mtp    or.10p</span></span>
<span><span class="co">#&gt; 1  fc.L_rm.1    1 0.8886724 0.10205778   0.507 0.0000000 0.0000000</span></span>
<span><span class="co">#&gt; 2  fc.L_rm.1    2 0.5524341 0.24397306   0.161 0.1136364 0.6136364</span></span>
<span><span class="co">#&gt; 3  fc.L_rm.1    3 0.7218896 0.10402928   0.776 0.0000000 0.1777778</span></span>
<span><span class="co">#&gt; 4  fc.L_rm.1    4 0.7415412 0.08774573   0.521 0.0000000 0.3636364</span></span>
<span><span class="co">#&gt; 5 fc.LQ_rm.1    1 0.8951549 0.09341583   0.687 0.0000000 0.0000000</span></span>
<span><span class="co">#&gt; 6 fc.LQ_rm.1    2 0.5609192 0.25051006   0.082 0.1136364 0.6363636</span></span>
<span><span class="co"># List of models with names corresponding to tune.args column label.</span></span>
<span><span class="fu"><a href="../reference/eval.models.html">eval.models</a></span><span class="op">(</span><span class="va">e.mx</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span>max.level <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 15</span></span>
<span><span class="co">#&gt;  $ fc.L_rm.1  :List of 23</span></span>
<span><span class="co">#&gt;   ..- attr(*, "class")= chr [1:3] "maxnet" "lognet" "glmnet"</span></span>
<span><span class="co">#&gt;  $ fc.LQ_rm.1 :List of 23</span></span>
<span><span class="co">#&gt;   ..- attr(*, "class")= chr [1:3] "maxnet" "lognet" "glmnet"</span></span>
<span><span class="co">#&gt;  $ fc.LQH_rm.1:List of 23</span></span>
<span><span class="co">#&gt;   ..- attr(*, "class")= chr [1:3] "maxnet" "lognet" "glmnet"</span></span>
<span><span class="co">#&gt;  $ fc.L_rm.2  :List of 23</span></span>
<span><span class="co">#&gt;   ..- attr(*, "class")= chr [1:3] "maxnet" "lognet" "glmnet"</span></span>
<span><span class="co">#&gt;  $ fc.LQ_rm.2 :List of 23</span></span>
<span><span class="co">#&gt;   ..- attr(*, "class")= chr [1:3] "maxnet" "lognet" "glmnet"</span></span>
<span><span class="co">#&gt;  $ fc.LQH_rm.2:List of 23</span></span>
<span><span class="co">#&gt;   ..- attr(*, "class")= chr [1:3] "maxnet" "lognet" "glmnet"</span></span>
<span><span class="co">#&gt;  $ fc.L_rm.3  :List of 23</span></span>
<span><span class="co">#&gt;   ..- attr(*, "class")= chr [1:3] "maxnet" "lognet" "glmnet"</span></span>
<span><span class="co">#&gt;  $ fc.LQ_rm.3 :List of 23</span></span>
<span><span class="co">#&gt;   ..- attr(*, "class")= chr [1:3] "maxnet" "lognet" "glmnet"</span></span>
<span><span class="co">#&gt;  $ fc.LQH_rm.3:List of 23</span></span>
<span><span class="co">#&gt;   ..- attr(*, "class")= chr [1:3] "maxnet" "lognet" "glmnet"</span></span>
<span><span class="co">#&gt;  $ fc.L_rm.4  :List of 23</span></span>
<span><span class="co">#&gt;   ..- attr(*, "class")= chr [1:3] "maxnet" "lognet" "glmnet"</span></span>
<span><span class="co">#&gt;  $ fc.LQ_rm.4 :List of 23</span></span>
<span><span class="co">#&gt;   ..- attr(*, "class")= chr [1:3] "maxnet" "lognet" "glmnet"</span></span>
<span><span class="co">#&gt;  $ fc.LQH_rm.4:List of 23</span></span>
<span><span class="co">#&gt;   ..- attr(*, "class")= chr [1:3] "maxnet" "lognet" "glmnet"</span></span>
<span><span class="co">#&gt;  $ fc.L_rm.5  :List of 23</span></span>
<span><span class="co">#&gt;   ..- attr(*, "class")= chr [1:3] "maxnet" "lognet" "glmnet"</span></span>
<span><span class="co">#&gt;  $ fc.LQ_rm.5 :List of 23</span></span>
<span><span class="co">#&gt;   ..- attr(*, "class")= chr [1:3] "maxnet" "lognet" "glmnet"</span></span>
<span><span class="co">#&gt;  $ fc.LQH_rm.5:List of 23</span></span>
<span><span class="co">#&gt;   ..- attr(*, "class")= chr [1:3] "maxnet" "lognet" "glmnet"</span></span>
<span><span class="co"># The "betas" slot in a maxnet model is a named vector of the variable </span></span>
<span><span class="co"># coefficients and what kind they are (in R formula notation).</span></span>
<span><span class="co"># Note that the html file that is created when maxent.jar is run is **not** kept.</span></span>
<span><span class="va">m1.mx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/eval.models.html">eval.models</a></span><span class="op">(</span><span class="va">e.mx</span><span class="op">)</span><span class="op">[[</span><span class="st">"fc.LQH_rm.1"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">m1.mx</span><span class="op">$</span><span class="va">betas</span></span>
<span><span class="co">#&gt;                                           bio2 </span></span>
<span><span class="co">#&gt;                                  -1.300772e-01 </span></span>
<span><span class="co">#&gt;                                          bio13 </span></span>
<span><span class="co">#&gt;                                   1.567920e-02 </span></span>
<span><span class="co">#&gt;                                          bio14 </span></span>
<span><span class="co">#&gt;                                  -3.408800e-03 </span></span>
<span><span class="co">#&gt;                                          bio15 </span></span>
<span><span class="co">#&gt;                                  -1.047407e-02 </span></span>
<span><span class="co">#&gt;                                          bio18 </span></span>
<span><span class="co">#&gt;                                   4.783857e-04 </span></span>
<span><span class="co">#&gt;                                          bio19 </span></span>
<span><span class="co">#&gt;                                   5.045810e-04 </span></span>
<span><span class="co">#&gt;                                      I(bio3^2) </span></span>
<span><span class="co">#&gt;                                  -5.605024e-04 </span></span>
<span><span class="co">#&gt;                                      I(bio5^2) </span></span>
<span><span class="co">#&gt;                                  -8.933996e-05 </span></span>
<span><span class="co">#&gt;                                      I(bio9^2) </span></span>
<span><span class="co">#&gt;                                  -2.114426e-03 </span></span>
<span><span class="co">#&gt;  hinge(bio2):10.3210696200935:18.9859161376953 </span></span>
<span><span class="co">#&gt;                                  -1.663205e+00 </span></span>
<span><span class="co">#&gt;  hinge(bio2):10.6098978373469:18.9859161376953 </span></span>
<span><span class="co">#&gt;                                  -2.082817e+00 </span></span>
<span><span class="co">#&gt;  hinge(bio2):4.83333349227905:8.58810031657316 </span></span>
<span><span class="co">#&gt;                                  -1.580067e+00 </span></span>
<span><span class="co">#&gt;  hinge(bio3):88.9814825252611:94.3169937133789 </span></span>
<span><span class="co">#&gt;                                   1.123558e+00 </span></span>
<span><span class="co">#&gt;  hinge(bio3):90.0485847628846:94.3169937133789 </span></span>
<span><span class="co">#&gt;                                   2.667189e+00 </span></span>
<span><span class="co">#&gt;  hinge(bio3):92.1827892381318:94.3169937133789 </span></span>
<span><span class="co">#&gt;                                  -2.634117e-01 </span></span>
<span><span class="co">#&gt;  hinge(bio3):42.0289840698242:67.6394377727898 </span></span>
<span><span class="co">#&gt;                                  -1.298906e+01 </span></span>
<span><span class="co">#&gt;  hinge(bio3):42.0289840698242:76.1762556737783 </span></span>
<span><span class="co">#&gt;                                   1.381063e+01 </span></span>
<span><span class="co">#&gt;   hinge(bio5):32.091081969592:37.1590003967285 </span></span>
<span><span class="co">#&gt;                                  -3.393143e+00 </span></span>
<span><span class="co">#&gt;  hinge(bio5):6.11800003051758:25.1226941322794 </span></span>
<span><span class="co">#&gt;                                   7.683829e+00 </span></span>
<span><span class="co">#&gt;  hinge(bio8):25.4872614485877:29.4118328094482 </span></span>
<span><span class="co">#&gt;                                   4.599610e-01 </span></span>
<span><span class="co">#&gt;  hinge(bio8):26.0479145001392:29.4118328094482 </span></span>
<span><span class="co">#&gt;                                   4.394250e+00 </span></span>
<span><span class="co">#&gt;  hinge(bio8):27.7298736547937:29.4118328094482 </span></span>
<span><span class="co">#&gt;                                  -4.326107e+00 </span></span>
<span><span class="co">#&gt;              hinge(bio13):447.448979591837:877 </span></span>
<span><span class="co">#&gt;                                  -5.871009e+00 </span></span>
<span><span class="co">#&gt;                hinge(bio13):0:196.877551020408 </span></span>
<span><span class="co">#&gt;                                   8.887840e-01 </span></span>
<span><span class="co">#&gt;                hinge(bio13):0:214.775510204082 </span></span>
<span><span class="co">#&gt;                                   1.749113e+00 </span></span>
<span><span class="co">#&gt;                hinge(bio13):0:304.265306122449 </span></span>
<span><span class="co">#&gt;                                  -7.253474e+00 </span></span>
<span><span class="co">#&gt;              hinge(bio14):129.469387755102:488 </span></span>
<span><span class="co">#&gt;                                  -7.833881e-02 </span></span>
<span><span class="co">#&gt;              hinge(bio14):139.428571428571:488 </span></span>
<span><span class="co">#&gt;                                  -1.871329e+00 </span></span>
<span><span class="co">#&gt;                hinge(bio14):0:29.8775510204082 </span></span>
<span><span class="co">#&gt;                                  -1.441614e-01 </span></span>
<span><span class="co">#&gt;                hinge(bio14):0:59.7551020408163 </span></span>
<span><span class="co">#&gt;                                  -1.069372e+00 </span></span>
<span><span class="co">#&gt; hinge(bio15):69.9453473772321:201.607177734375 </span></span>
<span><span class="co">#&gt;                                  -6.670763e-01 </span></span>
<span><span class="co">#&gt;                hinge(bio15):0:20.5721609933036 </span></span>
<span><span class="co">#&gt;                                   6.341525e+00 </span></span>
<span><span class="co">#&gt;                hinge(bio15):0:41.1443219866071 </span></span>
<span><span class="co">#&gt;                                  -1.084412e+00 </span></span>
<span><span class="co">#&gt;             hinge(bio18):728.571428571429:1700 </span></span>
<span><span class="co">#&gt;                                  -1.210289e+00 </span></span>
<span><span class="co">#&gt;             hinge(bio18):1110.20408163265:1700 </span></span>
<span><span class="co">#&gt;                                  -1.383907e+00 </span></span>
<span><span class="co">#&gt;                hinge(bio18):0:312.244897959184 </span></span>
<span><span class="co">#&gt;                                   5.003381e+00 </span></span>
<span><span class="co">#&gt;             hinge(bio19):847.755102040816:2077 </span></span>
<span><span class="co">#&gt;                                  -7.545615e-01 </span></span>
<span><span class="co">#&gt;             hinge(bio19):1017.30612244898:2077 </span></span>
<span><span class="co">#&gt;                                  -2.389713e+00 </span></span>
<span><span class="co">#&gt;             hinge(bio19):1059.69387755102:2077 </span></span>
<span><span class="co">#&gt;                                  -2.880705e-02 </span></span>
<span><span class="co">#&gt;                hinge(bio19):0:42.3877551020408 </span></span>
<span><span class="co">#&gt;                                   1.632038e+00 </span></span>
<span><span class="co">#&gt;                hinge(bio19):0:169.551020408163 </span></span>
<span><span class="co">#&gt;                                  -1.410946e-01 </span></span>
<span><span class="co">#&gt;                hinge(bio19):0:254.326530612245 </span></span>
<span><span class="co">#&gt;                                  -4.644699e-01 </span></span>
<span><span class="co">#&gt;                 hinge(bio19):0:508.65306122449 </span></span>
<span><span class="co">#&gt;                                   1.112090e+00</span></span>
<span><span class="co"># the enframe function from the tibble package makes this named vector into a </span></span>
<span><span class="co"># more readable table.</span></span>
<span><span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/enframe.html" class="external-link">enframe</a></span><span class="op">(</span><span class="va">m1.mx</span><span class="op">$</span><span class="va">betas</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 43 × 2</span></span></span>
<span><span class="co">#&gt;    name                                               value</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> bio2                                          -<span style="color: #BB0000;">0.130</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> bio13                                          0.015<span style="text-decoration: underline;">7</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> bio14                                         -<span style="color: #BB0000;">0.003</span><span style="color: #BB0000; text-decoration: underline;">41</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> bio15                                         -<span style="color: #BB0000;">0.010</span><span style="color: #BB0000; text-decoration: underline;">5</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> bio18                                          0.000<span style="text-decoration: underline;">478</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> bio19                                          0.000<span style="text-decoration: underline;">505</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> I(bio3^2)                                     -<span style="color: #BB0000;">0.000</span><span style="color: #BB0000; text-decoration: underline;">561</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> I(bio5^2)                                     -<span style="color: #BB0000;">0.000</span><span style="color: #BB0000; text-decoration: underline;">089</span><span style="color: #BB0000;">3</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> I(bio9^2)                                     -<span style="color: #BB0000;">0.002</span><span style="color: #BB0000; text-decoration: underline;">11</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> hinge(bio2):10.3210696200935:18.9859161376953 -<span style="color: #BB0000;">1.66</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 33 more rows</span></span></span>
<span><span class="co"># SpatRaster of model predictions (for extent of "envs") with names corresponding </span></span>
<span><span class="co"># to tune.args column label.</span></span>
<span><span class="fu"><a href="../reference/eval.predictions.html">eval.predictions</a></span><span class="op">(</span><span class="va">e.mx</span><span class="op">)</span></span>
<span><span class="co">#&gt; class       : SpatRaster </span></span>
<span><span class="co">#&gt; size        : 1152, 1110, 15  (nrow, ncol, nlyr)</span></span>
<span><span class="co">#&gt; resolution  : 0.08333333, 0.08333333  (x, y)</span></span>
<span><span class="co">#&gt; extent      : -124.8333, -32.33333, -56, 40  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; coord. ref. :  </span></span>
<span><span class="co">#&gt; source(s)   : memory</span></span>
<span><span class="co">#&gt; names       :    fc.L_rm.1,   fc.LQ_rm.1,  fc.LQH_rm.1,    fc.L_rm.2,  fc.LQ_rm.2,  fc.LQH_rm.2, ... </span></span>
<span><span class="co">#&gt; min values  : 2.746611e-06, 1.631124e-07, 1.242599e-08, 5.174928e-06, 3.58231e-06, 6.638164e-08, ... </span></span>
<span><span class="co">#&gt; max values  : 1.000000e+00, 1.000000e+00, 1.000000e+00, 1.000000e+00, 1.00000e+00, 1.000000e+00, ...</span></span>
<span><span class="co"># Original occurrence data coordinates with associated predictor variable values.</span></span>
<span><span class="fu"><a href="../reference/eval.occs.html">eval.occs</a></span><span class="op">(</span><span class="va">e.mx</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;   longitude  latitude     bio2     bio3     bio5     bio8     bio9 bio13 bio14</span></span>
<span><span class="co">#&gt; 1 -84.67201 10.478622 8.911917 77.36711 28.90700 22.62117 23.33933   416    92</span></span>
<span><span class="co">#&gt; 2 -84.62746 10.484519 9.172584 77.59566 31.44800 25.05200 25.75983   436    86</span></span>
<span><span class="co">#&gt; 3 -84.79254 10.347512 8.884500 76.11806 26.10200 19.50133 20.42650   407    72</span></span>
<span><span class="co">#&gt; 4 -76.79294  8.433710 7.091402 90.98947 30.52699 26.76349 26.80582   258    48</span></span>
<span><span class="co">#&gt; 5 -80.12543  8.610270 7.598667 81.98820 27.96900 22.59417 23.11900   350    31</span></span>
<span><span class="co">#&gt; 6 -79.55048  8.952963 6.787727 77.42120 31.50546 26.31576 27.24939   375    20</span></span>
<span><span class="co">#&gt;      bio15 bio18 bio19</span></span>
<span><span class="co">#&gt; 1 39.80974   448  1017</span></span>
<span><span class="co">#&gt; 2 44.78418   427   852</span></span>
<span><span class="co">#&gt; 3 43.76931   424   888</span></span>
<span><span class="co">#&gt; 4 47.05595   455   609</span></span>
<span><span class="co">#&gt; 5 55.86419   452   894</span></span>
<span><span class="co">#&gt; 6 66.06547   252   985</span></span>
<span><span class="co"># Background data coordinates with associated predictor variable values.</span></span>
<span><span class="fu"><a href="../reference/eval.bg.html">eval.bg</a></span><span class="op">(</span><span class="va">e.mx</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;       longitude   latitude      bio2     bio3   bio5     bio8     bio9 bio13</span></span>
<span><span class="co">#&gt; 11000 -68.20833  -4.625000  9.026417 82.53855 31.561 26.18217 25.67600   323</span></span>
<span><span class="co">#&gt; 21000 -69.12500  -8.791667 11.760584 78.68716 31.416 25.33333 23.58117   340</span></span>
<span><span class="co">#&gt; 31000 -70.54167 -13.125000  9.978250 75.81680 29.721 23.88500 22.62383   820</span></span>
<span><span class="co">#&gt; 41000 -63.87500 -20.791667 12.256917 58.70452 32.026 25.06850 20.10700   135</span></span>
<span><span class="co">#&gt; 51000 -63.20833  -9.208333 11.365750 71.17384 33.138 25.59017 24.89717   377</span></span>
<span><span class="co">#&gt; 61000 -62.45833  -2.625000  8.681084 88.57346 31.400 26.23833 26.32333   321</span></span>
<span><span class="co">#&gt;       bio14    bio15 bio18 bio19</span></span>
<span><span class="co">#&gt; 11000   104 31.34519   597   480</span></span>
<span><span class="co">#&gt; 21000    40 55.14707   898   172</span></span>
<span><span class="co">#&gt; 31000   256 42.86143  1598   846</span></span>
<span><span class="co">#&gt; 41000     3 82.63156   311    54</span></span>
<span><span class="co">#&gt; 51000    11 68.50643   508   170</span></span>
<span><span class="co">#&gt; 61000   127 30.23508   587   654</span></span>
<span><span class="co"># Partition group assignments for occurrence data.</span></span>
<span><span class="fu"><a href="../reference/eval.occs.grp.html">eval.occs.grp</a></span><span class="op">(</span><span class="va">e.mx</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;  Factor w/ 4 levels "1","2","3","4": 3 3 3 1 1 1 4 4 3 1 ...</span></span>
<span><span class="co"># Partition group assignments for background data.</span></span>
<span><span class="fu"><a href="../reference/eval.bg.grp.html">eval.bg.grp</a></span><span class="op">(</span><span class="va">e.mx</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;  Factor w/ 4 levels "1","2","3","4": 2 2 2 2 2 2 2 2 2 2 ...</span></span></code></pre></div>
<p>Maxent models run with <code>maxent.jar</code> have a different
structure from models run with <code>maxnet</code>, so below is a
demonstration of how to extract the “betas” information for
<code>maxent.jar</code> models. In the case that the user can run
<code>maxent.jar</code>, please run these lines independently. As many
users have issues running the Java version of Maxent, this portion is
not automatically evaluated for the vignette to avoid R Markdown
knitting errors.</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># NOTE -- This code is not evaluated and so will display no output in this vignette.</span></span>
<span><span class="co"># Please run independently.</span></span>
<span></span>
<span><span class="co"># For maxent.jar models, we can access this information in the lambdas slot.</span></span>
<span><span class="va">m1.mxjar</span> <span class="op">&lt;-</span> <span class="va">e.mxjar</span><span class="op">@</span><span class="va">models</span><span class="op">$</span><span class="va">fc.LQ_rm.1</span></span>
<span><span class="va">m1.mxjar</span><span class="op">@</span><span class="va">lambdas</span></span></code></pre></div>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># The notation used here is difficult to decipher, so check out the </span></span>
<span><span class="co"># [`rmaxent`](https://github.com/johnbaums/rmaxent/blob/master/) package.</span></span>
<span><span class="co"># available on Github for the `parse_lambdas()` function.</span></span>
<span><span class="fu"><a href="../reference/parse_lambdas.html">parse_lambdas</a></span><span class="op">(</span><span class="va">m1.mxjar</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># We can also get a long list of results statistics from the results slot.</span></span>
<span><span class="va">m1.mxjar</span><span class="op">@</span><span class="va">results</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="plot">Visualizing tuning results<a class="anchor" aria-label="anchor" href="#plot"></a>
</h2>
<p><code>ENMeval</code> 2.0.x has a built-in plotting function
(<code>eval.plot</code>) to visualize the results of the different
models you tuned in a ggplot. Here, we will plot average validation AUC
and omission rates for the models we tuned. The x-axis is the
regularization multiplier, and the color of the points and lines
represents the feature class. Notice that models with NA scores for
cross-validation are not plotted here, so hinge models with rm 2 and
higher are not shown because they had errors during
cross-validation.</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/evalplot.stats.html">evalplot.stats</a></span><span class="op">(</span>e <span class="op">=</span> <span class="va">e.mx</span>, stats <span class="op">=</span> <span class="st">"or.10p"</span>, color <span class="op">=</span> <span class="st">"fc"</span>, x.var <span class="op">=</span> <span class="st">"rm"</span><span class="op">)</span></span></code></pre></div>
<p><img src="ENMeval-2.0-vignette_files/figure-html/plot.res-1.png" width="672"></p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># We can plot more than one statistic at once with ggplot facetting.</span></span>
<span><span class="fu"><a href="../reference/evalplot.stats.html">evalplot.stats</a></span><span class="op">(</span>e <span class="op">=</span> <span class="va">e.mx</span>, stats <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"or.10p"</span>, <span class="st">"cbi.val"</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"fc"</span>, x.var <span class="op">=</span> <span class="st">"rm"</span><span class="op">)</span></span></code></pre></div>
<p><img src="ENMeval-2.0-vignette_files/figure-html/plot.res-2.png" width="672"></p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Sometimes the error bars make it hard to visualize the plot, so we can try turning them off.</span></span>
<span><span class="fu"><a href="../reference/evalplot.stats.html">evalplot.stats</a></span><span class="op">(</span>e <span class="op">=</span> <span class="va">e.mx</span>, stats <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"or.10p"</span>, <span class="st">"cbi.val"</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"fc"</span>, x.var <span class="op">=</span> <span class="st">"rm"</span>, </span>
<span>               error.bars <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="ENMeval-2.0-vignette_files/figure-html/plot.res-3.png" width="672"></p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># We can also fiddle with the dodge argument to jitter the positions of overlapping points.</span></span>
<span><span class="fu"><a href="../reference/evalplot.stats.html">evalplot.stats</a></span><span class="op">(</span>e <span class="op">=</span> <span class="va">e.mx</span>, stats <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"or.10p"</span>, <span class="st">"cbi.val"</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"fc"</span>, x.var <span class="op">=</span> <span class="st">"rm"</span>, </span>
<span>               dodge <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code></pre></div>
<p><img src="ENMeval-2.0-vignette_files/figure-html/plot.res-4.png" width="672"></p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Finally, we can switch which variables are on the x-axis and which symbolized by color.</span></span>
<span><span class="co"># ENMeval currently only accepts two variables for plotting at a time.</span></span>
<span><span class="fu"><a href="../reference/evalplot.stats.html">evalplot.stats</a></span><span class="op">(</span>e <span class="op">=</span> <span class="va">e.mx</span>, stats <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"or.10p"</span>, <span class="st">"cbi.val"</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"rm"</span>, x.var <span class="op">=</span> <span class="st">"fc"</span>, </span>
<span>               error.bars <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="ENMeval-2.0-vignette_files/figure-html/plot.res-5.png" width="672"></p>
</div>
<div class="section level2">
<h2 id="select">Model selection<a class="anchor" aria-label="anchor" href="#select"></a>
</h2>
<p>Once we have our results, we will want to select one or more models
that we think are optimal across all the models we ran. For this
example, we will demonstrate how to select models without considering
cross-validation results using AICc (Warren &amp; Seifert 2011; but see
Velasco &amp; González-Salazar 2019) and a sequential method that uses
cross-validation results by selecting models with the lowest average 10
percentile omission rate, and to break ties, with the highest average
validation Continuous Boyce Index (Hirzel et al. 2006) calculated with
the function from the R package <code>ecospat</code> (Di Cola et
al. 2017). Concerning AUC, Lobo et al. (2008) and others have pointed
out that validation AUC is inappropriate as an absolute performance
measure of presence-background ENMs, but it is valid to use for relative
comparisons of models constructed with the same data (Radosavljevic
&amp; Anderson 2014). Thus, it can be used as well to choose models,
though it is typically correlated with CBI.</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Overall results</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/eval.results.html">eval.results</a></span><span class="op">(</span><span class="va">e.mx</span><span class="op">)</span></span>
<span><span class="co"># Select the model with delta AICc equal to 0, or the one with the lowest AICc score.</span></span>
<span><span class="co"># In practice, models with delta AICc scores less than 2 are usually considered </span></span>
<span><span class="co"># statistically equivalent.</span></span>
<span><span class="va">opt.aicc</span> <span class="op">&lt;-</span> <span class="va">res</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">delta.AICc</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">opt.aicc</span></span>
<span><span class="co">#&gt;    fc rm   tune.args auc.train cbi.train auc.diff.avg auc.diff.sd auc.val.avg</span></span>
<span><span class="co">#&gt; 1 LQH  2 fc.LQH_rm.2 0.8822739     0.938   0.09416783   0.1200718   0.7887931</span></span>
<span><span class="co">#&gt;   auc.val.sd cbi.val.avg cbi.val.sd or.10p.avg or.10p.sd or.mtp.avg  or.mtp.sd</span></span>
<span><span class="co">#&gt; 1  0.1438574       0.619  0.3072599   0.214899 0.1841122 0.05113636 0.07509177</span></span>
<span><span class="co">#&gt;      AICc delta.AICc w.AIC ncoef</span></span>
<span><span class="co">#&gt; 1 3808.58          0     1    27</span></span>
<span><span class="co"># This dplyr operation executes the sequential criteria explained above, but</span></span>
<span><span class="co"># first removes settings with NA values for omission rate.</span></span>
<span><span class="va">opt.seq</span> <span class="op">&lt;-</span> <span class="va">res</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">or.10p.avg</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">or.10p.avg</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">or.10p.avg</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">cbi.val.avg</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">cbi.val.avg</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">opt.seq</span></span>
<span><span class="co">#&gt;    fc rm   tune.args auc.train cbi.train auc.diff.avg auc.diff.sd auc.val.avg</span></span>
<span><span class="co">#&gt; 1 LQH  3 fc.LQH_rm.3  0.860107     0.919    0.1037965   0.1181042   0.7703849</span></span>
<span><span class="co">#&gt;   auc.val.sd cbi.val.avg cbi.val.sd or.10p.avg or.10p.sd or.mtp.avg  or.mtp.sd</span></span>
<span><span class="co">#&gt; 1  0.1422159      0.6155  0.2875604  0.2039141 0.2097099 0.06818182 0.08088696</span></span>
<span><span class="co">#&gt;       AICc delta.AICc        w.AIC ncoef</span></span>
<span><span class="co">#&gt; 1 3854.314   45.73378 1.172294e-10    19</span></span></code></pre></div>
<p>Let’s now choose the optimal model settings based on the sequential
criteria and examine it.</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># We can select a single model from the ENMevaluation object using the tune.args of our</span></span>
<span><span class="co"># optimal model.</span></span>
<span><span class="va">mod.seq</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/eval.models.html">eval.models</a></span><span class="op">(</span><span class="va">e.mx</span><span class="op">)</span><span class="op">[[</span><span class="va">opt.seq</span><span class="op">$</span><span class="va">tune.args</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co"># Here are the non-zero coefficients in our model.</span></span>
<span><span class="va">mod.seq</span><span class="op">$</span><span class="va">betas</span></span>
<span><span class="co">#&gt;                                          bio2 </span></span>
<span><span class="co">#&gt;                                 -4.627958e-01 </span></span>
<span><span class="co">#&gt;                                         bio13 </span></span>
<span><span class="co">#&gt;                                  6.952041e-03 </span></span>
<span><span class="co">#&gt;                                         bio14 </span></span>
<span><span class="co">#&gt;                                 -9.994936e-03 </span></span>
<span><span class="co">#&gt;                                         bio15 </span></span>
<span><span class="co">#&gt;                                 -1.024131e-02 </span></span>
<span><span class="co">#&gt;                                         bio19 </span></span>
<span><span class="co">#&gt;                                  4.308801e-04 </span></span>
<span><span class="co">#&gt;                                     I(bio5^2) </span></span>
<span><span class="co">#&gt;                                 -4.196653e-04 </span></span>
<span><span class="co">#&gt;                                    I(bio18^2) </span></span>
<span><span class="co">#&gt;                                 -4.125060e-08 </span></span>
<span><span class="co">#&gt; hinge(bio3):90.0485847628846:94.3169937133789 </span></span>
<span><span class="co">#&gt;                                  1.041632e+00 </span></span>
<span><span class="co">#&gt; hinge(bio3):42.0289840698242:76.1762556737783 </span></span>
<span><span class="co">#&gt;                                  4.092149e+00 </span></span>
<span><span class="co">#&gt;  hinge(bio5):32.091081969592:37.1590003967285 </span></span>
<span><span class="co">#&gt;                                 -1.121875e+00 </span></span>
<span><span class="co">#&gt; hinge(bio5):6.11800003051758:25.1226941322794 </span></span>
<span><span class="co">#&gt;                                  1.906558e+00 </span></span>
<span><span class="co">#&gt; hinge(bio8):26.0479145001392:29.4118328094482 </span></span>
<span><span class="co">#&gt;                                  2.013521e+00 </span></span>
<span><span class="co">#&gt;              hinge(bio13):465.34693877551:877 </span></span>
<span><span class="co">#&gt;                                 -2.802205e-01 </span></span>
<span><span class="co">#&gt;               hinge(bio13):0:286.367346938775 </span></span>
<span><span class="co">#&gt;                                 -1.361221e+00 </span></span>
<span><span class="co">#&gt;               hinge(bio13):0:304.265306122449 </span></span>
<span><span class="co">#&gt;                                 -1.349046e-04 </span></span>
<span><span class="co">#&gt;               hinge(bio14):0:59.7551020408163 </span></span>
<span><span class="co">#&gt;                                 -1.211475e-01 </span></span>
<span><span class="co">#&gt;               hinge(bio18):0:312.244897959184 </span></span>
<span><span class="co">#&gt;                                  4.863442e+00 </span></span>
<span><span class="co">#&gt;            hinge(bio19):1059.69387755102:2077 </span></span>
<span><span class="co">#&gt;                                 -4.091483e-01 </span></span>
<span><span class="co">#&gt;             hinge(bio19):1144.4693877551:2077 </span></span>
<span><span class="co">#&gt;                                 -1.021308e+00</span></span>
<span><span class="co"># And these are the marginal response curves for the predictor variables wit non-zero </span></span>
<span><span class="co"># coefficients in our model. We define the y-axis to be the cloglog transformation, which</span></span>
<span><span class="co"># is an approximation of occurrence probability (with assumptions) bounded by 0 and 1</span></span>
<span><span class="co"># (Phillips et al. 2017).</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mod.seq</span>, type <span class="op">=</span> <span class="st">"cloglog"</span><span class="op">)</span></span>
<span><span class="co"># The above function plots with graphical customizations to include multiple plots on </span></span>
<span><span class="co"># the same page. </span></span>
<span><span class="co"># Clear the graphics device to avoid plotting sequential plots with these settings.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; null device </span></span>
<span><span class="co">#&gt;           1</span></span></code></pre></div>
<p>This is how to view the marginal response curves for
<code>maxent.jar</code> models.</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># NOTE -- This code is not evaluated and so will display no output in this vignette.</span></span>
<span><span class="co"># Please run independently.</span></span>
<span></span>
<span><span class="co"># maxent.jar models use the predicts::partialResponse() function for this</span></span>
<span><span class="va">pr</span> <span class="op">&lt;-</span> <span class="fu">predicts</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/predicts/man/response.html" class="external-link">partialResponse</a></span><span class="op">(</span><span class="va">e.mxjar</span><span class="op">@</span><span class="va">models</span><span class="op">[[</span><span class="va">opt.seq</span><span class="op">$</span><span class="va">tune.args</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                                var <span class="op">=</span> <span class="st">"bio5"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pr</span>, type <span class="op">=</span> <span class="st">"l"</span>, las <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p>Now we plot and inspect the prediction raster for our optimal model.
Note that by default for <code>maxent.jar</code> (versions &gt;3.3.3k)
or <code>maxnet</code> models, these predictions are in the ‘cloglog’
output format that is bounded between 0 and 1 (Phillips et al. 2017).
This can be changed with the <code>pred.type</code> argument in
<code>ENMevaluate</code>.</p>
<p>These predictions are for the entire extent of the input predictor
variable rasters, and thus include areas outside of the background
extent used for model training. Thus, we should interpret areas far
outside this extent with caution.</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># We can select the model predictions for our optimal model the same way we did for the </span></span>
<span><span class="co"># model object above.</span></span>
<span><span class="va">pred.seq</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/eval.predictions.html">eval.predictions</a></span><span class="op">(</span><span class="va">e.mx</span><span class="op">)</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">opt.seq</span><span class="op">$</span><span class="va">tune.args</span><span class="op">)</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pred.seq</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">terrain.colors</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># We can also plot the binned background points with the occurrence points on top to </span></span>
<span><span class="co"># visualize where the training data is located.</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/lines.html" class="external-link">points</a></span><span class="op">(</span><span class="fu"><a href="../reference/eval.bg.html">eval.bg</a></span><span class="op">(</span><span class="va">e.mx</span><span class="op">)</span>, pch <span class="op">=</span> <span class="fl">3</span>, col <span class="op">=</span> <span class="fu"><a href="../reference/eval.bg.grp.html">eval.bg.grp</a></span><span class="op">(</span><span class="va">e.mx</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/lines.html" class="external-link">points</a></span><span class="op">(</span><span class="fu"><a href="../reference/eval.occs.html">eval.occs</a></span><span class="op">(</span><span class="va">e.mx</span><span class="op">)</span>, pch <span class="op">=</span> <span class="fl">21</span>, bg <span class="op">=</span> <span class="fu"><a href="../reference/eval.occs.grp.html">eval.occs.grp</a></span><span class="op">(</span><span class="va">e.mx</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="ENMeval-2.0-vignette_files/figure-html/plotPred-1.png" width="672"></p>
<p>Let us now explore how model complexity changes the predictions in
our example. We will compare the simple model built with only linear
feature classes and the highest regularization multiplier value we used
(fc=‘L’, rm=5) with the complex model built with linear, quadratic, and
hinge feature classes and the lowest regularization multiplier value we
used (fc=‘LQH’, rm=1). We will first examine the marginal response
curves, and then the mapped model model predictions. Notice how the
simpler models tend to have more smooth predictions of suitability,
while the complex ones tend to show more patchiness. Deciding on whether
a model that is more simple or complex is appropriate for your study is
not straightforward, but guides exist in the literature (e.g., Merow et
al. 2014).</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># First, let's examine the non-zero model coefficients in the betas slot.</span></span>
<span><span class="co"># The simpler model has fewer model coefficients.</span></span>
<span><span class="va">mod.simple</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/eval.models.html">eval.models</a></span><span class="op">(</span><span class="va">e.mx</span><span class="op">)</span><span class="op">[[</span><span class="st">'fc.L_rm.5'</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">mod.complex</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/eval.models.html">eval.models</a></span><span class="op">(</span><span class="va">e.mx</span><span class="op">)</span><span class="op">[[</span><span class="st">'fc.LQH_rm.1'</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">mod.simple</span><span class="op">$</span><span class="va">betas</span></span>
<span><span class="co">#&gt;         bio2         bio3         bio8        bio13        bio14        bio15 </span></span>
<span><span class="co">#&gt; -0.532966677  0.036981721  0.014488869  0.004688425 -0.013258936 -0.023718739 </span></span>
<span><span class="co">#&gt;        bio18 </span></span>
<span><span class="co">#&gt;  0.001309774</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">mod.simple</span><span class="op">$</span><span class="va">betas</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 7</span></span>
<span><span class="va">mod.complex</span><span class="op">$</span><span class="va">betas</span></span>
<span><span class="co">#&gt;                                           bio2 </span></span>
<span><span class="co">#&gt;                                  -1.300772e-01 </span></span>
<span><span class="co">#&gt;                                          bio13 </span></span>
<span><span class="co">#&gt;                                   1.567920e-02 </span></span>
<span><span class="co">#&gt;                                          bio14 </span></span>
<span><span class="co">#&gt;                                  -3.408800e-03 </span></span>
<span><span class="co">#&gt;                                          bio15 </span></span>
<span><span class="co">#&gt;                                  -1.047407e-02 </span></span>
<span><span class="co">#&gt;                                          bio18 </span></span>
<span><span class="co">#&gt;                                   4.783857e-04 </span></span>
<span><span class="co">#&gt;                                          bio19 </span></span>
<span><span class="co">#&gt;                                   5.045810e-04 </span></span>
<span><span class="co">#&gt;                                      I(bio3^2) </span></span>
<span><span class="co">#&gt;                                  -5.605024e-04 </span></span>
<span><span class="co">#&gt;                                      I(bio5^2) </span></span>
<span><span class="co">#&gt;                                  -8.933996e-05 </span></span>
<span><span class="co">#&gt;                                      I(bio9^2) </span></span>
<span><span class="co">#&gt;                                  -2.114426e-03 </span></span>
<span><span class="co">#&gt;  hinge(bio2):10.3210696200935:18.9859161376953 </span></span>
<span><span class="co">#&gt;                                  -1.663205e+00 </span></span>
<span><span class="co">#&gt;  hinge(bio2):10.6098978373469:18.9859161376953 </span></span>
<span><span class="co">#&gt;                                  -2.082817e+00 </span></span>
<span><span class="co">#&gt;  hinge(bio2):4.83333349227905:8.58810031657316 </span></span>
<span><span class="co">#&gt;                                  -1.580067e+00 </span></span>
<span><span class="co">#&gt;  hinge(bio3):88.9814825252611:94.3169937133789 </span></span>
<span><span class="co">#&gt;                                   1.123558e+00 </span></span>
<span><span class="co">#&gt;  hinge(bio3):90.0485847628846:94.3169937133789 </span></span>
<span><span class="co">#&gt;                                   2.667189e+00 </span></span>
<span><span class="co">#&gt;  hinge(bio3):92.1827892381318:94.3169937133789 </span></span>
<span><span class="co">#&gt;                                  -2.634117e-01 </span></span>
<span><span class="co">#&gt;  hinge(bio3):42.0289840698242:67.6394377727898 </span></span>
<span><span class="co">#&gt;                                  -1.298906e+01 </span></span>
<span><span class="co">#&gt;  hinge(bio3):42.0289840698242:76.1762556737783 </span></span>
<span><span class="co">#&gt;                                   1.381063e+01 </span></span>
<span><span class="co">#&gt;   hinge(bio5):32.091081969592:37.1590003967285 </span></span>
<span><span class="co">#&gt;                                  -3.393143e+00 </span></span>
<span><span class="co">#&gt;  hinge(bio5):6.11800003051758:25.1226941322794 </span></span>
<span><span class="co">#&gt;                                   7.683829e+00 </span></span>
<span><span class="co">#&gt;  hinge(bio8):25.4872614485877:29.4118328094482 </span></span>
<span><span class="co">#&gt;                                   4.599610e-01 </span></span>
<span><span class="co">#&gt;  hinge(bio8):26.0479145001392:29.4118328094482 </span></span>
<span><span class="co">#&gt;                                   4.394250e+00 </span></span>
<span><span class="co">#&gt;  hinge(bio8):27.7298736547937:29.4118328094482 </span></span>
<span><span class="co">#&gt;                                  -4.326107e+00 </span></span>
<span><span class="co">#&gt;              hinge(bio13):447.448979591837:877 </span></span>
<span><span class="co">#&gt;                                  -5.871009e+00 </span></span>
<span><span class="co">#&gt;                hinge(bio13):0:196.877551020408 </span></span>
<span><span class="co">#&gt;                                   8.887840e-01 </span></span>
<span><span class="co">#&gt;                hinge(bio13):0:214.775510204082 </span></span>
<span><span class="co">#&gt;                                   1.749113e+00 </span></span>
<span><span class="co">#&gt;                hinge(bio13):0:304.265306122449 </span></span>
<span><span class="co">#&gt;                                  -7.253474e+00 </span></span>
<span><span class="co">#&gt;              hinge(bio14):129.469387755102:488 </span></span>
<span><span class="co">#&gt;                                  -7.833881e-02 </span></span>
<span><span class="co">#&gt;              hinge(bio14):139.428571428571:488 </span></span>
<span><span class="co">#&gt;                                  -1.871329e+00 </span></span>
<span><span class="co">#&gt;                hinge(bio14):0:29.8775510204082 </span></span>
<span><span class="co">#&gt;                                  -1.441614e-01 </span></span>
<span><span class="co">#&gt;                hinge(bio14):0:59.7551020408163 </span></span>
<span><span class="co">#&gt;                                  -1.069372e+00 </span></span>
<span><span class="co">#&gt; hinge(bio15):69.9453473772321:201.607177734375 </span></span>
<span><span class="co">#&gt;                                  -6.670763e-01 </span></span>
<span><span class="co">#&gt;                hinge(bio15):0:20.5721609933036 </span></span>
<span><span class="co">#&gt;                                   6.341525e+00 </span></span>
<span><span class="co">#&gt;                hinge(bio15):0:41.1443219866071 </span></span>
<span><span class="co">#&gt;                                  -1.084412e+00 </span></span>
<span><span class="co">#&gt;             hinge(bio18):728.571428571429:1700 </span></span>
<span><span class="co">#&gt;                                  -1.210289e+00 </span></span>
<span><span class="co">#&gt;             hinge(bio18):1110.20408163265:1700 </span></span>
<span><span class="co">#&gt;                                  -1.383907e+00 </span></span>
<span><span class="co">#&gt;                hinge(bio18):0:312.244897959184 </span></span>
<span><span class="co">#&gt;                                   5.003381e+00 </span></span>
<span><span class="co">#&gt;             hinge(bio19):847.755102040816:2077 </span></span>
<span><span class="co">#&gt;                                  -7.545615e-01 </span></span>
<span><span class="co">#&gt;             hinge(bio19):1017.30612244898:2077 </span></span>
<span><span class="co">#&gt;                                  -2.389713e+00 </span></span>
<span><span class="co">#&gt;             hinge(bio19):1059.69387755102:2077 </span></span>
<span><span class="co">#&gt;                                  -2.880705e-02 </span></span>
<span><span class="co">#&gt;                hinge(bio19):0:42.3877551020408 </span></span>
<span><span class="co">#&gt;                                   1.632038e+00 </span></span>
<span><span class="co">#&gt;                hinge(bio19):0:169.551020408163 </span></span>
<span><span class="co">#&gt;                                  -1.410946e-01 </span></span>
<span><span class="co">#&gt;                hinge(bio19):0:254.326530612245 </span></span>
<span><span class="co">#&gt;                                  -4.644699e-01 </span></span>
<span><span class="co">#&gt;                 hinge(bio19):0:508.65306122449 </span></span>
<span><span class="co">#&gt;                                   1.112090e+00</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">mod.complex</span><span class="op">$</span><span class="va">betas</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 43</span></span>
<span><span class="co"># Next, let's take a look at the marginal response curves.</span></span>
<span><span class="co"># The complex model has marginal responses with more curves (from quadratic terms) and </span></span>
<span><span class="co"># spikes (from hinge terms).</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mod.simple</span>, type <span class="op">=</span> <span class="st">"cloglog"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mod.complex</span>, type <span class="op">=</span> <span class="st">"cloglog"</span><span class="op">)</span></span></code></pre></div>
<p><img src="ENMeval-2.0-vignette_files/figure-html/plot.pred2-1.png" width="672"></p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># To get the data for the marginal response curves from a maxnet model, use the </span></span>
<span><span class="co"># following code. You can then plot them any way you want.</span></span>
<span><span class="va">mod.complex.mrc</span> <span class="op">&lt;-</span><span class="fu">maxnet</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/maxnet/man/plot.maxnet.html" class="external-link">response.plot</a></span><span class="op">(</span><span class="va">mod.complex</span>, </span>
<span>                                        v <span class="op">=</span> <span class="st">"bio2"</span>, </span>
<span>                                        type <span class="op">=</span> <span class="st">"cloglog"</span>,</span>
<span>                                        plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">mod.complex.mrc</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bio2</span>, y <span class="op">=</span> <span class="va">pred</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"cloglog prediction"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># Finally, let's cut the plotting area into two rows to visualize the predictions </span></span>
<span><span class="co"># side-by-side.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="ENMeval-2.0-vignette_files/figure-html/plot.pred2-2.png" width="672"></p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># The simplest model: linear features only and high regularization.</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/eval.predictions.html">eval.predictions</a></span><span class="op">(</span><span class="va">e.mx</span><span class="op">)</span><span class="op">[[</span><span class="st">'fc.L_rm.5'</span><span class="op">]</span><span class="op">]</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">30</span>,<span class="fl">20</span><span class="op">)</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">90</span>,<span class="op">-</span><span class="fl">30</span><span class="op">)</span>, </span>
<span>     main <span class="op">=</span> <span class="st">'L_5 prediction'</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">terrain.colors</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># The most complex model: linear, quadratic, and hinge features with low regularization</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/eval.predictions.html">eval.predictions</a></span><span class="op">(</span><span class="va">e.mx</span><span class="op">)</span><span class="op">[[</span><span class="st">'fc.LQH_rm.1'</span><span class="op">]</span><span class="op">]</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">30</span>,<span class="fl">20</span><span class="op">)</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">90</span>,<span class="op">-</span><span class="fl">30</span><span class="op">)</span>, </span>
<span>     main <span class="op">=</span> <span class="st">'LQH_1 prediction'</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">terrain.colors</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="ENMeval-2.0-vignette_files/figure-html/plot.pred2-3.png" width="672"></p>
</div>
<div class="section level2">
<h2 id="null">Null models<a class="anchor" aria-label="anchor" href="#null"></a>
</h2>
<p>We were able to calculate performance metrics for our model, such as
omission rates and AUC, but we do not know how they compare to the same
metrics calculated on null models built with random data. This
information would allow us to determine the significance and effect
sizes of these metrics. If the metrics we calculated for our empirical
model were not significantly different from those calculated for a
series of null models, we would have not have high confidence that they
meaningfully represent how well our empirical model performed. Raes
&amp; ter Steege (2007) first introduced the concept of a null ENM and
demonstrated how it can be applied. This approach sampled random
occurrence records from the study extent and evaluated null models with
random cross-validation. Since then some enhancements have been made to
this original approach. One such modification was implemented by Bohl et
al. (2019), who proposed evaluating models on the same withheld
occurrence data as the empirical model. This approach allows for direct
comparisons between null performance metrics and those of the emprical
models. Kass et al. (2020) further extended this method by configuring
it to calculate null performance metrics using spatial partitions.</p>
<p><code>ENMeval</code> 2.0.x has the functionality to run null ENMs
using the Bohl et al. method with the Kass et al. extension and
visualize the performance of the empirical model against the null model
averages.</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># We first run the null simulations with 100 iterations to get a reasonable null distribution </span></span>
<span><span class="co"># for comparisons with the empirical values</span></span>
<span><span class="va">mod.null</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ENMnulls.html">ENMnulls</a></span><span class="op">(</span><span class="va">e.mx</span>, mod.settings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fc <span class="op">=</span> <span class="st">"LQH"</span>, rm <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>, no.iter <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># We can inspect the results of each null simulation.</span></span>
<span><span class="fu"><a href="../reference/null.results.html">null.results</a></span><span class="op">(</span><span class="va">mod.null</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;    fc rm   tune.args auc.train cbi.train auc.diff.avg auc.diff.sd auc.val.avg</span></span>
<span><span class="co">#&gt; 1 LQH  3 fc.LQH_rm.3 0.6507439     0.897    0.1621316   0.1739245   0.5186240</span></span>
<span><span class="co">#&gt; 2 LQH  3 fc.LQH_rm.3 0.6679562     0.910    0.2606238   0.1711055   0.5007493</span></span>
<span><span class="co">#&gt; 3 LQH  3 fc.LQH_rm.3 0.6774240     0.977    0.2368137   0.2049700   0.5259562</span></span>
<span><span class="co">#&gt; 4 LQH  3 fc.LQH_rm.3 0.6808377     0.969    0.2858186   0.1456140   0.4977401</span></span>
<span><span class="co">#&gt; 5 LQH  3 fc.LQH_rm.3 0.6901094     0.964    0.1784331   0.2114035   0.5151189</span></span>
<span><span class="co">#&gt; 6 LQH  3 fc.LQH_rm.3 0.6663147     0.962    0.2592358   0.1736700   0.4961347</span></span>
<span><span class="co">#&gt;   auc.val.sd cbi.val.avg cbi.val.sd or.10p.avg  or.10p.sd  or.mtp.avg</span></span>
<span><span class="co">#&gt; 1  0.2094396     0.12500  0.6422466  0.1791667 0.09337961 0.000000000</span></span>
<span><span class="co">#&gt; 2  0.2736006    -0.02425  0.7858657  0.2842172 0.28860956 0.033333333</span></span>
<span><span class="co">#&gt; 3  0.2680005     0.13300  0.7856327  0.2613636 0.39416843 0.005555556</span></span>
<span><span class="co">#&gt; 4  0.2552322     0.05100  0.7734662  0.3342172 0.34400734 0.016666667</span></span>
<span><span class="co">#&gt; 5  0.2213815     0.06525  0.6656277  0.2566919 0.27836130 0.050000000</span></span>
<span><span class="co">#&gt; 6  0.2450237    -0.01925  0.6993618  0.2390152 0.34145831 0.011111111</span></span>
<span><span class="co">#&gt;    or.mtp.sd ncoef</span></span>
<span><span class="co">#&gt; 1 0.00000000    11</span></span>
<span><span class="co">#&gt; 2 0.06666667    18</span></span>
<span><span class="co">#&gt; 3 0.01111111    13</span></span>
<span><span class="co">#&gt; 4 0.02127616    14</span></span>
<span><span class="co">#&gt; 5 0.06382847    12</span></span>
<span><span class="co">#&gt; 6 0.02222222    19</span></span>
<span><span class="co"># And even inspect the results of each partition of each null simulation.</span></span>
<span><span class="fu"><a href="../reference/null.results.partitions.html">null.results.partitions</a></span><span class="op">(</span><span class="va">mod.null</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;   iter   tune.args fold   auc.val    auc.diff cbi.val    or.mtp     or.10p</span></span>
<span><span class="co">#&gt; 1    1 fc.LQH_rm.3    1 0.6768476 0.002594511   0.674 0.0000000 0.15555556</span></span>
<span><span class="co">#&gt; 2    1 fc.LQH_rm.3    2 0.4396597 0.171479059  -0.237 0.0000000 0.15909091</span></span>
<span><span class="co">#&gt; 3    1 fc.LQH_rm.3    3 0.2585588 0.401438625  -0.596 0.0000000 0.31111111</span></span>
<span><span class="co">#&gt; 4    1 fc.LQH_rm.3    4 0.6994300 0.073014078   0.659 0.0000000 0.09090909</span></span>
<span><span class="co">#&gt; 5    2 fc.LQH_rm.3    1 0.5833962 0.174584670   0.389 0.1333333 0.28888889</span></span>
<span><span class="co">#&gt; 6    2 fc.LQH_rm.3    2 0.3992003 0.141336266  -0.568 0.0000000 0.11363636</span></span>
<span><span class="co"># For a summary, we can look at a comparison between the empirical and simulated results.</span></span>
<span><span class="fu"><a href="../reference/null.emp.results.html">null.emp.results</a></span><span class="op">(</span><span class="va">mod.null</span><span class="op">)</span></span>
<span><span class="co">#&gt;   statistic    auc.train  cbi.train      auc.val     auc.diff       cbi.val</span></span>
<span><span class="co">#&gt; 1  emp.mean 8.609204e-01 0.94100000 7.662181e-01  0.107169028  5.927500e-01</span></span>
<span><span class="co">#&gt; 2    emp.sd           NA         NA 1.448854e-01  0.125131727  3.326694e-01</span></span>
<span><span class="co">#&gt; 3 null.mean 6.723666e-01 0.89842000 4.760547e-01  0.217913428 -3.863750e-02</span></span>
<span><span class="co">#&gt; 4   null.sd 1.860910e-02 0.08927092 4.554626e-02  0.045507789  1.399808e-01</span></span>
<span><span class="co">#&gt; 5    zscore 1.013234e+01 0.47697505 6.370740e+00 -2.433526252  4.510528e+00</span></span>
<span><span class="co">#&gt; 6    pvalue 1.985106e-24 0.31668994 9.405895e-11  0.007476276  3.233319e-06</span></span>
<span><span class="co">#&gt;       or.mtp      or.10p</span></span>
<span><span class="co">#&gt; 1 0.06250000  0.16969697</span></span>
<span><span class="co">#&gt; 2 0.07276278  0.13135003</span></span>
<span><span class="co">#&gt; 3 0.03426641  0.27601641</span></span>
<span><span class="co">#&gt; 4 0.04489074  0.09926046</span></span>
<span><span class="co">#&gt; 5 0.62894011 -1.07111581</span></span>
<span><span class="co">#&gt; 6 0.73530587  0.14205868</span></span>
<span><span class="co"># Finally, we can make plots of the null model results as a histogram. In this</span></span>
<span><span class="co"># example, the empirical validation CBI value (solid red line) is significantly </span></span>
<span><span class="co"># higher than random, as it is higher than the 99th quantile of the null values</span></span>
<span><span class="co"># (dashed purple line). For reference, this plot also includes the null 95th </span></span>
<span><span class="co"># quantile (dashed blue line) and the null mean (solid blue line). For more </span></span>
<span><span class="co"># details, please see ?evalplot.nulls.</span></span>
<span><span class="fu"><a href="../reference/evalplot.nulls.html">evalplot.nulls</a></span><span class="op">(</span><span class="va">mod.null</span>, stats <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"or.10p"</span>, <span class="st">"cbi.val"</span><span class="op">)</span>, plot.type <span class="op">=</span> <span class="st">"histogram"</span><span class="op">)</span></span></code></pre></div>
<p><img src="ENMeval-2.0-vignette_files/figure-html/unnamed-chunk-20-1.png" width="672"></p>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Or we can visualize the results with a violin plot. The red point shows the </span></span>
<span><span class="co"># empirical value and the shape shows the density of the null distribution</span></span>
<span><span class="co"># with lines denoting the quantiles.</span></span>
<span><span class="fu"><a href="../reference/evalplot.nulls.html">evalplot.nulls</a></span><span class="op">(</span><span class="va">mod.null</span>, stats <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"or.10p"</span>, <span class="st">"cbi.val"</span><span class="op">)</span>, plot.type <span class="op">=</span> <span class="st">"violin"</span><span class="op">)</span></span></code></pre></div>
<p><img src="ENMeval-2.0-vignette_files/figure-html/unnamed-chunk-20-2.png" width="672"></p>
</div>
<div class="section level2">
<h2 id="metadata">Metadata<a class="anchor" aria-label="anchor" href="#metadata"></a>
</h2>
<p>The last point this vignette will discuss is extremely important for
all scientific research: reproducibility. <code>ENMeval</code> 2.0.x now
catalogs details of the analysis essential for reproducibility in a
<code>rangeModelMetadata</code> object, accessible from the output
<code>ENMevaluation</code> object. The framework and philosophy behind
<code>rangeModelMetadata</code> is described by Merow et al. (2019), and
other related efforts to define crucial metadata standards and rating
systems for ENMs have come out since (e.g., Araújo et al. 2019, Feng et
al. 2019, Zurell et al. 2020). Metadata generated by
<code>ENMeval</code> can be saved to a CSV file for sharing with
collaborators or for use in supplemental information for a manuscript,
etc.</p>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generate a rangeModelMetadata object based on the information stored in the </span></span>
<span><span class="co"># ENMevaluate object.</span></span>
<span><span class="va">rmm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/eval.rmm.html">eval.rmm</a></span><span class="op">(</span><span class="va">e.mx</span><span class="op">)</span></span>
<span><span class="co"># We can fill in the model selection rules based on the sequential criteria we chose.</span></span>
<span><span class="va">rmm</span><span class="op">$</span><span class="va">model</span><span class="op">$</span><span class="va">selectionRules</span> <span class="op">&lt;-</span> <span class="st">"lowest 10 percentile omission rate, </span></span>
<span><span class="st">break ties with average validation CBI"</span></span>
<span><span class="co"># We can also enter our optimal model settings and the details of our optimal </span></span>
<span><span class="co"># model's prediction.</span></span>
<span><span class="va">rmm</span><span class="op">$</span><span class="va">model</span><span class="op">$</span><span class="va">finalModelSettings</span> <span class="op">&lt;-</span> <span class="st">"LQH3"</span></span>
<span><span class="va">rmm</span><span class="op">$</span><span class="va">prediction</span><span class="op">$</span><span class="va">continuous</span><span class="op">$</span><span class="va">minVal</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/global.html" class="external-link">global</a></span><span class="op">(</span><span class="va">pred.seq</span>, <span class="va">min</span><span class="op">)</span></span>
<span><span class="va">rmm</span><span class="op">$</span><span class="va">prediction</span><span class="op">$</span><span class="va">continuous</span><span class="op">$</span><span class="va">maxVal</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/global.html" class="external-link">global</a></span><span class="op">(</span><span class="va">pred.seq</span>, <span class="va">max</span><span class="op">)</span></span>
<span><span class="va">rmm</span><span class="op">$</span><span class="va">prediction</span><span class="op">$</span><span class="va">continuous</span><span class="op">$</span><span class="va">units</span> <span class="op">&lt;-</span> <span class="st">"suitability (cloglog transformation)"</span></span>
<span><span class="co"># This is just an example -- there may be more fields relevant to fill in for your study.</span></span></code></pre></div>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Finally, we can save the metadata to a CSV file.</span></span>
<span><span class="fu">rangeModelMetadata</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rangeModelMetadata/man/rmmToCSV.html" class="external-link">rmmToCSV</a></span><span class="op">(</span><span class="va">rmm</span>, <span class="st">"rmm_mx1.csv"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="resources">References and Resources<a class="anchor" aria-label="anchor" href="#resources"></a>
</h2>
<p>This list of references and resources is not exhaustive by any means,
and mainly includes those sources we referenced in the vignette text.
The field is expanding further every year, and there are many other
papers and packages that one learning about ENMs should explore.</p>
<div class="section level6">
<h6 id="web-resources">Web Resources<a class="anchor" aria-label="anchor" href="#web-resources"></a>
</h6>
<ul>
<li><p><a href="https://rspatial.org/raster/sdm/" class="external-link">Hijmans, R. &amp;
Elith, J. (2021) Species distribution modeling.</a></p></li>
<li><p><a href="https://groups.google.com/forum/embed/#!forum/maxent" class="external-link">Maxent
Google Group</a></p></li>
<li><p><a href="https://biodiversityinformatics.amnh.org/open_source/maxent/Maxent_tutorial_2021.pdf" class="external-link">Phillips,
S. J. (2021) A brief tutorial on Maxent. AT&amp;T Research. Available
at:
https://biodiversityinformatics.amnh.org/open_source/maxent/Maxent_tutorial_2021.pdf</a></p></li>
<li><p><a href="https://www.molecularecologist.com/2013/04/species-distribution-models-in-r/" class="external-link">Yoder,
J. (2013). Species distribution models in R. The Molecular
Ecologist.</a></p></li>
</ul>
</div>
<div class="section level6">
<h6 id="general-guides">General Guides<a class="anchor" aria-label="anchor" href="#general-guides"></a>
</h6>
<ul>
<li><p><a href="https://doi.org/10.1126/sciadv.aat4858" class="external-link">Araújo, M. B.,
Anderson, R. P., Barbosa, A. M., Beale, C. M., Dormann, C. F., Early,
R., Garcia, R. A., Guisan, A., Maiorano, L., Naimi, B., &amp; O’Hara, R.
B. (2019). Standards for distribution models in biodiversity
assessments. Science Advances, 5: eaat4858.</a></p></li>
<li><p><a href="https://doi.org/10.1017/CBO9780511810602" class="external-link">Franklin, J.
(2010). Mapping species distributions: spatial inference and prediction.
Cambridge University Press.</a></p></li>
<li><p><a href="https://doi.org/10.1017/9781139028271" class="external-link">Guisan A.,
Thuiller W., &amp; Zimmermann N. E. (2017). Habitat Suitability and
Distribution Models with Applications in R. Cambridge University Press,
Cambridge, UK.</a></p></li>
<li><p><a href="https://doi.org/10.1111/ecog.00845" class="external-link">Merow, C., Smith, M.
J., Edwards Jr, T. C., Guisan, A., McMahon, S. M., Normand, S.,
Thuiller, W., Wüest, R. O., Zimmermann, N. E., &amp; Elith, J. (2014).
What do we gain from simplicity versus complexity in species
distribution models? Ecography, 37: 1267–1281.</a></p></li>
<li><p><a href="https://press.princeton.edu/titles/9641.html" class="external-link">Peterson,
A.T., Soberón, J., Pearson, R.G., Anderson, R.P., Martínez-Meyer, E.,
Nakamura, M., &amp; Araújo, M.B. (2011) Ecological Niches and Geographic
Distributions. Monographs in Population Biology, 49. Princeton
University Press.</a></p></li>
</ul>
<p>-<a href="https://doi.org/10.1016/j.ecolmodel.2008.11.010" class="external-link">VanDerWal,
J., Shoo, L. P., Graham, C., &amp; Williams, S. E. (2009). Selecting
pseudo-absence data for presence-only distribution modeling: how far
should you stray from what you know?. Ecological Modelling, 220:
589-594.</a></p>
</div>
<div class="section level6">
<h6 id="maxent">Maxent<a class="anchor" aria-label="anchor" href="#maxent"></a>
</h6>
<ul>
<li><p><a href="https://doi.org/10.1111/j.1472-4642.2010.00725.x" class="external-link">Elith,
J., Phillips, S. J., Hastie, T., Dudík, M., Chee, Y. E., &amp; Yates, C.
J. (2011). A statistical explanation of MaxEnt for ecologists. Diversity
and Distributions, 17(1), 43-57.</a></p></li>
<li><p><a href="https://onlinelibrary.wiley.com/doi/abs/10.1111/j.1600-0587.2013.07872.x" class="external-link">Merow,
C., Smith, M., &amp; Silander, J.A. (2013). A practical guide to Maxent:
what it does, and why inputs and settings matter. Ecography, 36,
1-12.</a></p></li>
<li><p><a href="https://doi.org/10.1016/j.ecolmodel.2005.03.026" class="external-link">Phillips, S. J.,
Anderson, R. P., &amp; Schapire, R. E. (2006). Maximum entropy modeling
of species geographic distributions. Ecological Modelling, 190:
231–259.</a></p></li>
<li><p><a href="https://doi.org/10.1111/j.0906-7590.2008.5203.x" class="external-link">Phillips, S. J.,
&amp; Dudík, M. (2008). Modeling of species distributions with Maxent:
new extensions and a comprehensive evaluation. Ecography, 31:
161-175.</a></p></li>
<li><p><a href="https://doi.org/10.1111/ecog.03049" class="external-link">Phillips, S. J.,
Anderson, R. P., Dudík, M., Schapire, R. E., &amp; Blair, M. E. (2017).
Opening the black box: an open-source release of Maxent. Ecography, 40:
887–893.</a></p></li>
</ul>
</div>
<div class="section level6">
<h6 id="environmental-and-niche-similarity">Environmental and Niche Similarity<a class="anchor" aria-label="anchor" href="#environmental-and-niche-similarity"></a>
</h6>
<ul>
<li><p><a href="https://doi.org/10.1111/j.2041-210X.2010.00036.x" class="external-link">Elith,
J., Kearney, M., &amp; Phillips, S. (2010). The art of modelling
range‐shifting species. Methods in Ecology and Evolution, 1(4),
330-342.</a></p></li>
<li><p><a href="https://doi.org/10.1007/s10531-009-9584-8" class="external-link">Fitzpatrick,
M. C., &amp; Hargrove, W. W. (2009). The projection of species
distribution models and the problem of non-analog climate. Biodiversity
and Conservation, 18(8), 2255-2261.</a></p></li>
<li><p><a href="https://doi.org/10.1111/ddi.12209" class="external-link">Mesgaran, M. B.,
Cousens, R. D., &amp; Webber, B. L. (2014). Here be dragons: a tool for
quantifying novelty due to covariate range and correlation change when
projecting species distribution models. Diversity and Distributions, 20:
1147-1159.</a></p></li>
<li><p><a href="https://doi.org/10.1016/j.ecolmodel.2013.04.011" class="external-link">Owens,
H. L., Campbell, L. P., Dornak, L. L., Saupe, E. E., Barve, N., Soberón,
J., … &amp; Peterson, A. T. (2013). Constraints on interpretation of
ecological niche models by limited environmental ranges on calibration
areas. Ecological Modelling, 263, 10-18.</a></p></li>
<li><p><a href="https://dx.doi.org/10.1111/j.1558-5646.2008.00482.x" class="external-link">Warren, D.
L., Glor, R. E., &amp; Turelli, M. (2008). Environmental niche
equivalency versus conservatism: quantitative approaches to niche
evolution. Evolution: International Journal of Organic Evolution, 62:
2868-2883.</a></p></li>
</ul>
</div>
<div class="section level6">
<h6 id="model-evaluation">Model Evaluation<a class="anchor" aria-label="anchor" href="#model-evaluation"></a>
</h6>
<ul>
<li><p><a href="https://onlinelibrary.wiley.com/doi/abs/10.1111/ecog.01132" class="external-link">Aiello-Lammens,
M.E., Boria, R.A., Radosavljevic, A., Vilela, B., &amp; Anderson, R.P.
(2015) spThin: an R package for spatial thinning of species occurrence
records for use in ecological niche models. Ecography, 38,
541-545.</a></p></li>
<li><p><a href="https://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.463.359&amp;rep=rep1&amp;type=pdf" class="external-link">Fielding,
A.H. &amp; Bell, J.F. (1997). A review of methods for the assessment of
prediction errors in conservation presence-absence models. Environmental
Conservation 24, 38-49.</a></p></li>
<li><p><a href="https://doi.org/10.1016/j.ecolmodel.2019.108719" class="external-link">Hallgren, W.,
Santana, F., Low-Choy, S., Zhao, Y., &amp; Mackey, B. (2019). Species
distribution models can be highly sensitive to algorithm configuration.
Ecological Modelling, 408: 108719.</a></p></li>
<li><p><a href="https://web.stanford.edu/~hastie/ElemStatLearn/" class="external-link">Hastie,
T., Tibshirani, R., &amp; Friedman, J. (2009). The Elements of
Statistical Learning: Data Mining, Inference, and Prediction. Springer,
New York, NY.</a></p></li>
<li><p><a href="https://doi.org/10.1016/j.ecolmodel.2006.05.017" class="external-link">Hirzel,
A. H., Le Lay, G., Helfer, V., Randin, C., &amp; Guisan, A. (2006).
Evaluating the ability of habitat suitability models to predict species
presences. Ecological Modelling, 199: 142-152.</a></p></li>
<li><p><a href="https://doi.org/10.1111/ecog.04886" class="external-link">Kass, J. M.,
Anderson, R. P., Espinosa‐Lucas, A., Juárez‐Jaimes, V., Martínez‐Salas,
E., Botello, F., Tavera, G., Flores‐Martínez, J. J., &amp;
Sánchez‐Cordero, V. (2020). Biotic predictors with phenological
information improve range estimates for migrating monarch butterflies in
Mexico. Ecography, 43(3), 341-352.</a></p></li>
<li><p><a href="https://doi.org/10.1111/j.1466-8238.2007.00358.x" class="external-link">Lobo,
J. M., Jiménez‐Valverde, A., &amp; Real, R. (2008). AUC: a misleading
measure of the performance of predictive distribution models. Global
ecology and Biogeography, 17: 145-151.</a></p></li>
<li><p><a href="https://doi.org/10.1111/j.1365-2699.2006.01594.x" class="external-link">Pearson, R.G.,
Raxworthy, C.J., Nakamura, M., &amp; Peterson, A.T. (2007) Predicting
species distributions from small numbers of occurrence records: a test
case using cryptic geckos in Madagascar. Journal of Biogeography 34,
102-117.</a></p></li>
<li><p><a href="http://dx.doi.org/10.1016/j.ecolmodel.2007.11.008" class="external-link">Peterson, A.
T., Papeş, M., &amp; Soberón, J. (2008). Rethinking receiver operating
characteristic analysis applications in ecological niche modeling.
Ecological Modelling, 213: 63-72.</a></p></li>
<li><p><a href="https://onlinelibrary.wiley.com/doi/abs/10.1111/jbi.12227" class="external-link">Radosavljevic,
A. &amp; Anderson, R.P. (2014). Making better Maxent models of species
distributions: complexity, overfitting and evaluation. Journal of
Biogeography 41, 629-643.</a></p></li>
<li><p><a href="https://doi.org/10.1111/ecog.02881" class="external-link">Roberts, D. R.,
Bahn, V., Ciuti, S., Boyce, M. S., Elith, J., Guillera‐Arroita, G.,
Hauenstein, S., Lahoz‐Monfort, J. J., Schröder, B., Thuiller, W., &amp;
Warton, D. I. (2017). Cross-validation strategies for data with
temporal, spatial, hierarchical, or phylogenetic structure. Ecography,
40: 913–929.</a></p></li>
<li><p><a href="https://www.sciencedirect.com/science/article/pii/S0304380013004043" class="external-link">Shcheglovitova,
M. &amp; Anderson, R.P. (2013). Estimating optimal complexity for
ecological niche models: A jackknife approach for species with small
sample sizes. Ecological Modelling 269: 9-17.</a></p></li>
<li><p><a href="https://doi.org/10.1016/j.ecoinf.2019.02.005" class="external-link">Velasco,
J. A. &amp; González-Salazar, C. (2019). Akaike information criterion
should not be a “test” of geographical prediction accuracy in ecological
niche modelling. Ecological Informatics, 51: 25–32.</a></p></li>
<li><p><a href="https://onlinelibrary.wiley.com/doi/abs/10.1111/j.1365-2699.2009.02174.x" class="external-link">Veloz,
S.D. (2009) Spatially autocorrelated sampling falsely inflates measures
of accuracy for presence-only niche models. Journal of Biogeography 36:
2290-2299.</a></p></li>
<li><p><a href="https://doi.org/10.1890/10-1171.1" class="external-link">Warren, D. L. &amp;
Seifert, S. N. (2011). Ecological niche modeling in Maxent: the
importance of model complexity and the performance of model selection
criteria. Ecological Applications, 21: 335–342.</a></p></li>
</ul>
</div>
<div class="section level6">
<h6 id="null-enms">Null ENMs<a class="anchor" aria-label="anchor" href="#null-enms"></a>
</h6>
<ul>
<li><p><a href="https://doi.org/10.1111/jbi.13573" class="external-link">Bohl, C. L., Kass, J.
M., &amp; Anderson, R. P. (2019). A new null model approach to quantify
performance and significance for ecological niche models of species
distributions. Journal of Biogeography, 46: 1101-1111.</a></p></li>
<li><p><a href="https://www.jstor.org/stable/30244521" class="external-link">Raes, N., &amp;
ter Steege, H. (2007). A null-model for significance testing of
presence-only species distribution models. Ecography, 30(5),
727-736.</a></p></li>
</ul>
</div>
<div class="section level6">
<h6 id="model-transfer">Model Transfer<a class="anchor" aria-label="anchor" href="#model-transfer"></a>
</h6>
<ul>
<li><p><a href="https://doi.org/10.1093/jmammal/gyz162" class="external-link">Soley-Guardia,
M., Carnaval, A. C., &amp; Anderson, R. P. (2019). Sufficient versus
optimal climatic stability during the Late Quaternary: using
environmental quality to guide phylogeographic inferences in a
Neotropical montane system. Journal of Mammalogy, 100:
1783–1807.</a></p></li>
<li><p><a href="https://besjournals.onlinelibrary.wiley.com/doi/abs/10.1111/j.2041-210X.2011.00170.x" class="external-link">Wenger,
S.J. &amp; Olden, J.D. (2012) Assessing transferability of ecological
models: an underappreciated aspect of statistical validation. Methods in
Ecology and Evolution, 3: 260-267.</a></p></li>
<li><p><a href="https://doi.org/10.1111/ddi.12257" class="external-link">Wright, A. N.,
Hijmans, R. J., Schwartz, M. W., &amp; Shaffer, H. B. (2015). Multiple
sources of uncertainty affect metrics for ranking conservation risk
under climate change. Diversity and Distributions, 21(1),
111-122.</a></p></li>
</ul>
</div>
<div class="section level6">
<h6 id="metadata-1">Metadata<a class="anchor" aria-label="anchor" href="#metadata-1"></a>
</h6>
<ul>
<li><p><a href="https://doi.org/10.1038/s41559-019-0972-5" class="external-link">Feng, X.,
Park, D. S., Walker, C., Peterson, A. T., Merow, C., &amp; Papeş, M.
(2019). A checklist for maximizing reproducibility of ecological niche
models. Nature Ecology and Evolution, 3: 1382–1395.</a></p></li>
<li><p><a href="https://doi.org/10.1111/geb.12993" class="external-link">Merow, C., Maitner,
B. S., Owens, H. L., Kass, J. M., Enquist, B. J., Jetz, W., &amp;
Guralnick, R. (2019). Species’ range model metadata standards: RMMS.
Global Ecology and Biogeography, 28: 1912–1924.</a></p></li>
<li><p><a href="https://doi.org/10.1111/ecog.04960" class="external-link">Zurell, D.,
Franklin, J., König, C., Bouchet, P. J., Dormann, C. F., Elith, J.,
Fandos, G., Feng, X., Guillera‐Arroita, G., Guisan, A. &amp;
Lahoz‐Monfort, J. J. (2020). A standard protocol for reporting species
distribution models. Ecography, 43: 1261–1277.</a></p></li>
</ul>
</div>
<div class="section level6">
<h6 id="r-packages-for-enms">R Packages for ENMs<a class="anchor" aria-label="anchor" href="#r-packages-for-enms"></a>
</h6>
<ul>
<li><p>Baumgartner, J., &amp; Wilson, P. (2021). <em>rmaxent: Tools for
working with Maxent in R</em>. R package version 0.8.5.9000, URL: <a href="https://github.com/johnbaums/rmaxent" class="external-link">https://github.com/johnbaums/rmaxent</a>.</p></li>
<li><p><a href="http://dx.doi.org/10.7717/peerj.6281" class="external-link">Cobos, M. E.,
Peterson, A. T., Barve, N., &amp; Osorio-Olvera, L. (2019). kuenm: an R
package for detailed development of ecological niche models using
Maxent. PeerJ, 7: e6281</a></p></li>
<li><p><a href="https://doi.org/10.1111/ecog.02671" class="external-link">Di Cola, V.,
Broennimann, O., Petitpierre, B., Breiner, F. T., d’Amen, M., Randin,
C., … &amp; Guisan, A. (2017). ecospat: an R package to support spatial
analyses and modeling of species niches and distributions. Ecography,
40(6), 774-787.</a></p></li>
<li><p><a href="https://doi.org/10.1111/2041-210X.12261" class="external-link">Muscarella, R.,
Galante, P. J., Soley-Guardia, M., Boria, R. A., Kass, J. M., Uriarte,
M. &amp; Anderson, R. P. (2014). ENMeval: An R package for conducting
spatially independent evaluations and estimating optimal model
complexity for Maxent ecological niche models. Methods in Ecology and
Evolution, 5: 1198–1205.</a></p></li>
<li><p><a href="https://doi.org/10.1111/2041-210X.13107" class="external-link">Valavi, R.,
Elith, J., Lahoz-Monfort, J. J., &amp; Guillera-Arroita G. (2019)
blockCV: An R package for generating spatially or environmentally
separated folds for k-fold cross-validation of species distribution
models. Methods in Ecology and Evolution, 10:225–232.</a></p></li>
<li><p>Wickham H. (2016). ggplot2: Elegant Graphics for Data Analysis.
Springer-Verlag New York. <a href="https://ggplot2.tidyverse.org" class="external-link">https://ggplot2.tidyverse.org</a>.</p></li>
</ul>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jamie M. Kass, Robert Muscarella, Peter J. Galante, Corentin Bohl, Gonzalo E. Buitrago-Pinilla, Robert A. Boria, Mariano Soley-Guardia, Robert P. Anderson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
